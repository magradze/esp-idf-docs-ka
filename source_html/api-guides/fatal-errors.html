

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Fatal Errors &mdash; ESP-IDF Programming Guide v4.1-dev-2071-gf91080637 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="https://media.readthedocs.com/javascript/readthedocs-doc-embed.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Flash Encryption" href="../security/flash-encryption.html" />
    <link rel="prev" title="Support for external RAM" href="external-ram.html" /> 

<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="https://docs.espressif.com/projects/esp-idf/en/latest/api-guides/fatal-errors.html" />

<link rel="stylesheet" href="https://media.readthedocs.com/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="../_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = "api-guides/fatal-errors"
READTHEDOCS_DATA['source_suffix'] = ".rst"
</script>

<script type="text/javascript" src="https://media.readthedocs.com/javascript/readthedocs-analytics.js"></script>

<!-- end RTD <extrahead> -->
<script async type="text/javascript" src="../../../../../_/static/javascript/readthedocs-addons.js"></script><meta name="readthedocs-project-slug" content="espressif-esp-idf" /><meta name="readthedocs-version-slug" content="latest" /><meta name="readthedocs-resolver-filename" content="/api-guides/fatal-errors.html" /><meta name="readthedocs-http-status" content="200" /></head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> ESP-IDF Programming Guide
          

          
            
            <img src="../_static/espressif-logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../get-started/index.html">Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api-reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hw-reference/index.html">H/W Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../esp32s2.html">ESP32-S2 Preview Support</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">API Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="app_trace.html">Application Level Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="blufi.html">BluFi</a></li>
<li class="toctree-l2"><a class="reference internal" href="bootloader.html">Bootloader</a></li>
<li class="toctree-l2"><a class="reference internal" href="build-system.html">Build System</a></li>
<li class="toctree-l2"><a class="reference internal" href="build-system-legacy.html">Build System (Legacy GNU Make)</a></li>
<li class="toctree-l2"><a class="reference internal" href="console.html">Console Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="deep-sleep-stub.html">Deep Sleep Wake Stubs</a></li>
<li class="toctree-l2"><a class="reference internal" href="error-handling.html">Error Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="esp-ble-mesh/ble-mesh-index.html">ESP-BLE-MESH</a></li>
<li class="toctree-l2"><a class="reference internal" href="mesh.html">ESP-MESH (Wi-Fi)</a></li>
<li class="toctree-l2"><a class="reference internal" href="core_dump.html">ESP32 Core Dump</a></li>
<li class="toctree-l2"><a class="reference internal" href="event-handling.html">Event Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="external-ram.html">External SPI-connected RAM</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="fatal-errors.html#">Fatal Errors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="fatal-errors.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="fatal-errors.html#panic-handler">Panic Handler</a></li>
<li class="toctree-l3"><a class="reference internal" href="fatal-errors.html#register-dump-and-backtrace">Register Dump and Backtrace</a></li>
<li class="toctree-l3"><a class="reference internal" href="fatal-errors.html#gdb-stub">GDB Stub</a></li>
<li class="toctree-l3"><a class="reference internal" href="fatal-errors.html#guru-meditation-errors">Guru Meditation Errors</a><ul>
<li class="toctree-l4"><a class="reference internal" href="fatal-errors.html#illegalinstruction">IllegalInstruction</a></li>
<li class="toctree-l4"><a class="reference internal" href="fatal-errors.html#instrfetchprohibited">InstrFetchProhibited</a></li>
<li class="toctree-l4"><a class="reference internal" href="fatal-errors.html#loadprohibited-storeprohibited">LoadProhibited, StoreProhibited</a></li>
<li class="toctree-l4"><a class="reference internal" href="fatal-errors.html#integerdividebyzero">IntegerDivideByZero</a></li>
<li class="toctree-l4"><a class="reference internal" href="fatal-errors.html#loadstorealignment">LoadStoreAlignment</a></li>
<li class="toctree-l4"><a class="reference internal" href="fatal-errors.html#loadstoreerror">LoadStoreError</a></li>
<li class="toctree-l4"><a class="reference internal" href="fatal-errors.html#unhandled-debug-exception">Unhandled debug exception</a></li>
<li class="toctree-l4"><a class="reference internal" href="fatal-errors.html#interrupt-wdt-timeout-on-cpu0-cpu1">Interrupt wdt timeout on CPU0 / CPU1</a></li>
<li class="toctree-l4"><a class="reference internal" href="fatal-errors.html#cache-disabled-but-cached-memory-region-accessed">Cache disabled but cached memory region accessed</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="fatal-errors.html#other-fatal-errors">Other Fatal Errors</a><ul>
<li class="toctree-l4"><a class="reference internal" href="fatal-errors.html#brownout">Brownout</a></li>
<li class="toctree-l4"><a class="reference internal" href="fatal-errors.html#corrupt-heap">Corrupt Heap</a></li>
<li class="toctree-l4"><a class="reference internal" href="fatal-errors.html#stack-smashing">Stack Smashing</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../security/flash-encryption.html">Flash Encryption</a></li>
<li class="toctree-l2"><a class="reference internal" href="freertos-smp.html">FreeRTOS SMP Changes</a></li>
<li class="toctree-l2"><a class="reference internal" href="general-notes.html">General Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="hlinterrupts.html">High Level Interrupts</a></li>
<li class="toctree-l2"><a class="reference internal" href="jtag-debugging/index.html">JTAG Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="linker-script-generation.html">Linker Script Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="lwip.html">lwIP TCP/IP Stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="partition-tables.html">Partition Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="RF_calibration.html">RF Calibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="romconsole.html">ROM debug console</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/secure-boot.html">Secure Boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="thread-local-storage.html">Thread Local Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools/index.html">Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="ulp.html">ULP Coprocessor</a></li>
<li class="toctree-l2"><a class="reference internal" href="ulp-legacy.html">ULP Coprocessor (Legacy GNU Make)</a></li>
<li class="toctree-l2"><a class="reference internal" href="unit-tests-legacy.html">Unit Testing (Legacy GNU Make)</a></li>
<li class="toctree-l2"><a class="reference internal" href="unit-tests.html">Unit Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="wifi.html">WiFi Driver</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../libraries-and-frameworks/index.html">Libraries and Frameworks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/index.html">Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../versions.html">Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../COPYRIGHT.html">Copyrights</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../languages.html">语言/Languages</a></li>
<li class="toctree-l1"><a class="reference external" href="https://readthedocs.com/projects/espressif-esp-idf/downloads/">Guide Downloads</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ESP-IDF Programming Guide</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">API Guides</a> &raquo;</li>
        
      <li>Fatal Errors</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/espressif/esp-idf/blob/master/docs/en/api-guides/fatal-errors.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="fatal-errors">
<h1>Fatal Errors<a class="headerlink" href="fatal-errors.html#fatal-errors" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://espressif-docs.readthedocs-hosted.com/projects/esp-idf/zh_CN/latest/api-guides/fatal-errors.html">[中文]</a></p>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="fatal-errors.html#overview" title="Permalink to this headline">¶</a></h2>
<p>In certain situations, execution of the program can not be continued in a well defined way. In ESP-IDF, these situations include:</p>
<ul class="simple">
<li>CPU Exceptions: Illegal Instruction, Load/Store Alignment Error, Load/Store Prohibited error, Double Exception.</li>
<li>System level checks and safeguards:<ul>
<li><a class="reference internal" href="../api-reference/system/wdts.html"><span class="doc">Interrupt watchdog</span></a> timeout</li>
<li><a class="reference internal" href="../api-reference/system/wdts.html"><span class="doc">Task watchdog</span></a> timeout (only fatal if <a class="reference internal" href="../api-reference/kconfig.html#config-esp-task-wdt-panic"><span class="std std-ref">CONFIG_ESP_TASK_WDT_PANIC</span></a> is set)</li>
<li>Cache access error</li>
<li>Brownout detection event</li>
<li>Stack overflow</li>
<li>Stack smashing protection check</li>
<li>Heap integrity check</li>
</ul>
</li>
<li>Failed assertions, via <code class="docutils literal notranslate"><span class="pre">assert</span></code>, <code class="docutils literal notranslate"><span class="pre">configASSERT</span></code> and similar macros.</li>
</ul>
<p>This guide explains the procedure used in ESP-IDF for handling these errors, and provides suggestions on troubleshooting the errors.</p>
</div>
<div class="section" id="panic-handler">
<h2>Panic Handler<a class="headerlink" href="fatal-errors.html#panic-handler" title="Permalink to this headline">¶</a></h2>
<p>Every error cause listed in the <a class="reference internal" href="fatal-errors.html#overview">Overview</a> will be handled by <em>panic handler</em>.</p>
<p>Panic handler will start by printing the cause of the error to the console. For CPU exceptions, the message will be similar to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Guru</span> <span class="n">Meditation</span> <span class="n">Error</span><span class="p">:</span> <span class="n">Core</span> <span class="mi">0</span> <span class="n">panic</span><span class="s1">&#39;ed (IllegalInstruction). Exception was unhandled.</span>
</pre></div>
</div>
<p>For some of the system level checks (interrupt watchdog, cache access error), the message will be similar to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Guru</span> <span class="n">Meditation</span> <span class="n">Error</span><span class="p">:</span> <span class="n">Core</span> <span class="mi">0</span> <span class="n">panic</span><span class="s1">&#39;ed (Cache disabled but cached memory region accessed)</span>
</pre></div>
</div>
<p>In all cases, error cause will be printed in parens. See <a class="reference internal" href="fatal-errors.html#guru-meditation-errors">Guru Meditation Errors</a> for a list of possible error causes.</p>
<p>Subsequent behavior of the panic handler can be set using <a class="reference internal" href="../api-reference/kconfig.html#config-esp32-panic"><span class="std std-ref">CONFIG_ESP32_PANIC</span></a> configuration choice. The available options are:</p>
<ul>
<li><p class="first">Print registers and reboot (<code class="docutils literal notranslate"><span class="pre">CONFIG_ESP32_PANIC_PRINT_REBOOT</span></code>) — default option.</p>
<p>This will print register values at the point of the exception, print the backtrace, and restart the chip.</p>
</li>
<li><p class="first">Print registers and halt (<code class="docutils literal notranslate"><span class="pre">CONFIG_ESP32_PANIC_PRINT_HALT</span></code>)</p>
<p>Similar to the above option, but halt instead of rebooting. External reset is required to restart the program.</p>
</li>
<li><p class="first">Silent reboot (<code class="docutils literal notranslate"><span class="pre">CONFIG_ESP32_PANIC_SILENT_REBOOT</span></code>)</p>
<p>Don’t print registers or backtrace, restart the chip immediately.</p>
</li>
<li><p class="first">Invoke GDB Stub (<code class="docutils literal notranslate"><span class="pre">CONFIG_ESP32_PANIC_GDBSTUB</span></code>)</p>
<p>Start GDB server which can communicate with GDB over console UART port. See <a class="reference internal" href="fatal-errors.html#gdb-stub">GDB Stub</a> for more details.</p>
</li>
</ul>
<p>Behavior of panic handler is affected by two other configuration options.</p>
<ul>
<li><p class="first">If <a class="reference internal" href="../api-reference/kconfig.html#config-esp32-debug-ocdaware"><span class="std std-ref">CONFIG_ESP32_DEBUG_OCDAWARE</span></a> is enabled (which is the default), panic handler will detect whether a JTAG debugger is connected. If it is, execution will be halted and control will be passed to the debugger. In this case registers and backtrace are not dumped to the console, and GDBStub / Core Dump functions are not used.</p>
</li>
<li><p class="first">If <a class="reference internal" href="core_dump.html"><span class="doc">Core Dump</span></a> feature is enabled (<code class="docutils literal notranslate"><span class="pre">CONFIG_ESP32_ENABLE_COREDUMP_TO_FLASH</span></code> or <code class="docutils literal notranslate"><span class="pre">CONFIG_ESP32_ENABLE_COREDUMP_TO_UART</span></code> options), then system state (task stacks and registers) will be dumped either to Flash or UART, for later analysis.</p>
</li>
<li><p class="first">If <a class="reference internal" href="../api-reference/kconfig.html#config-esp-panic-handler-iram"><span class="std std-ref">CONFIG_ESP_PANIC_HANDLER_IRAM</span></a> is disabled (disabled by default), the panic handler code is placed in flash memory not IRAM. This means that if ESP-IDF crashes while flash cache is disabled, the panic handler will automatically re-enable flash cache before running GDB Stub or Core Dump. This adds some minor risk, if the flash cache status is also corrupted during the crash.</p>
<p>If this option is enabled, the panic handler code is placed in IRAM. This allows the panic handler to run without needing to re-enable cache first. This may be necessary to debug some complex issues with crashes while flash cache is disabled (for example, when writing to SPI flash).</p>
</li>
</ul>
<p>The following diagram illustrates panic handler behavior:</p>
<div class="figure align-center" id="id1">
<div><a class="reference internal image-reference" href="../_images/blockdiag-22776548ae95d5078e3bcc31e14c99215ae269f0.png"><img height="1020.0" src="../_images/blockdiag-22776548ae95d5078e3bcc31e14c99215ae269f0.png" width="960.0" /></a></div><p class="caption"><span class="caption-text">Panic Handler Flowchart (click to enlarge)</span><a class="headerlink" href="fatal-errors.html#id1" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="register-dump-and-backtrace">
<h2>Register Dump and Backtrace<a class="headerlink" href="fatal-errors.html#register-dump-and-backtrace" title="Permalink to this headline">¶</a></h2>
<p>Unless <code class="docutils literal notranslate"><span class="pre">CONFIG_ESP32_PANIC_SILENT_REBOOT</span></code> option is enabled, panic handler prints some of the CPU registers, and the backtrace, to the console:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Core</span> <span class="mi">0</span> <span class="n">register</span> <span class="n">dump</span><span class="p">:</span>
<span class="n">PC</span>      <span class="p">:</span> <span class="mh">0x400e14ed</span>  <span class="n">PS</span>      <span class="p">:</span> <span class="mh">0x00060030</span>  <span class="n">A0</span>      <span class="p">:</span> <span class="mh">0x800d0805</span>  <span class="n">A1</span>      <span class="p">:</span> <span class="mh">0x3ffb5030</span>
<span class="n">A2</span>      <span class="p">:</span> <span class="mh">0x00000000</span>  <span class="n">A3</span>      <span class="p">:</span> <span class="mh">0x00000001</span>  <span class="n">A4</span>      <span class="p">:</span> <span class="mh">0x00000001</span>  <span class="n">A5</span>      <span class="p">:</span> <span class="mh">0x3ffb50dc</span>
<span class="n">A6</span>      <span class="p">:</span> <span class="mh">0x00000000</span>  <span class="n">A7</span>      <span class="p">:</span> <span class="mh">0x00000001</span>  <span class="n">A8</span>      <span class="p">:</span> <span class="mh">0x00000000</span>  <span class="n">A9</span>      <span class="p">:</span> <span class="mh">0x3ffb5000</span>
<span class="n">A10</span>     <span class="p">:</span> <span class="mh">0x00000000</span>  <span class="n">A11</span>     <span class="p">:</span> <span class="mh">0x3ffb2bac</span>  <span class="n">A12</span>     <span class="p">:</span> <span class="mh">0x40082d1c</span>  <span class="n">A13</span>     <span class="p">:</span> <span class="mh">0x06ff1ff8</span>
<span class="n">A14</span>     <span class="p">:</span> <span class="mh">0x3ffb7078</span>  <span class="n">A15</span>     <span class="p">:</span> <span class="mh">0x00000000</span>  <span class="n">SAR</span>     <span class="p">:</span> <span class="mh">0x00000014</span>  <span class="n">EXCCAUSE</span><span class="p">:</span> <span class="mh">0x0000001d</span>
<span class="n">EXCVADDR</span><span class="p">:</span> <span class="mh">0x00000000</span>  <span class="n">LBEG</span>    <span class="p">:</span> <span class="mh">0x4000c46c</span>  <span class="n">LEND</span>    <span class="p">:</span> <span class="mh">0x4000c477</span>  <span class="n">LCOUNT</span>  <span class="p">:</span> <span class="mh">0xffffffff</span>

<span class="n">Backtrace</span><span class="p">:</span> <span class="mh">0x400e14ed</span><span class="p">:</span><span class="mh">0x3ffb5030</span> <span class="mh">0x400d0802</span><span class="p">:</span><span class="mh">0x3ffb5050</span>
</pre></div>
</div>
<p>Register values printed are the register values in the exception frame, i.e. values at the moment when CPU exception or other fatal error has occured.</p>
<p>Register dump is not printed if the panic handler was executed as a result of an <code class="docutils literal notranslate"><span class="pre">abort()</span></code> call.</p>
<p>In some cases, such as interrupt watchdog timeout, panic handler may print additional CPU registers (EPC1-EPC4) and the registers/backtrace of the code running on the other CPU.</p>
<p>Backtrace line contains PC:SP pairs, where PC is the Program Counter and SP is Stack Pointer, for each stack frame of the current task. If a fatal error happens inside an ISR, the backtrace may include PC:SP pairs both from the task which was interrupted, and from the ISR.</p>
<p>If <a class="reference internal" href="tools/idf-monitor.html"><span class="doc">IDF Monitor</span></a> is used, Program Counter values will be converted to code locations (function name, file name, and line number), and the output will be annotated with additional lines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Core</span> <span class="mi">0</span> <span class="n">register</span> <span class="n">dump</span><span class="p">:</span>
<span class="n">PC</span>      <span class="p">:</span> <span class="mh">0x400e14ed</span>  <span class="n">PS</span>      <span class="p">:</span> <span class="mh">0x00060030</span>  <span class="n">A0</span>      <span class="p">:</span> <span class="mh">0x800d0805</span>  <span class="n">A1</span>      <span class="p">:</span> <span class="mh">0x3ffb5030</span>
<span class="mh">0x400e14ed</span><span class="p">:</span> <span class="n">app_main</span> <span class="n">at</span> <span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">esp</span><span class="o">/</span><span class="n">example</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">cpp</span><span class="p">:</span><span class="mi">36</span>

<span class="n">A2</span>      <span class="p">:</span> <span class="mh">0x00000000</span>  <span class="n">A3</span>      <span class="p">:</span> <span class="mh">0x00000001</span>  <span class="n">A4</span>      <span class="p">:</span> <span class="mh">0x00000001</span>  <span class="n">A5</span>      <span class="p">:</span> <span class="mh">0x3ffb50dc</span>
<span class="n">A6</span>      <span class="p">:</span> <span class="mh">0x00000000</span>  <span class="n">A7</span>      <span class="p">:</span> <span class="mh">0x00000001</span>  <span class="n">A8</span>      <span class="p">:</span> <span class="mh">0x00000000</span>  <span class="n">A9</span>      <span class="p">:</span> <span class="mh">0x3ffb5000</span>
<span class="n">A10</span>     <span class="p">:</span> <span class="mh">0x00000000</span>  <span class="n">A11</span>     <span class="p">:</span> <span class="mh">0x3ffb2bac</span>  <span class="n">A12</span>     <span class="p">:</span> <span class="mh">0x40082d1c</span>  <span class="n">A13</span>     <span class="p">:</span> <span class="mh">0x06ff1ff8</span>
<span class="mh">0x40082d1c</span><span class="p">:</span> <span class="n">_calloc_r</span> <span class="n">at</span> <span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">esp</span><span class="o">/</span><span class="n">esp</span><span class="o">-</span><span class="n">idf</span><span class="o">/</span><span class="n">components</span><span class="o">/</span><span class="n">newlib</span><span class="o">/</span><span class="n">syscalls</span><span class="o">.</span><span class="n">c</span><span class="p">:</span><span class="mi">51</span>

<span class="n">A14</span>     <span class="p">:</span> <span class="mh">0x3ffb7078</span>  <span class="n">A15</span>     <span class="p">:</span> <span class="mh">0x00000000</span>  <span class="n">SAR</span>     <span class="p">:</span> <span class="mh">0x00000014</span>  <span class="n">EXCCAUSE</span><span class="p">:</span> <span class="mh">0x0000001d</span>
<span class="n">EXCVADDR</span><span class="p">:</span> <span class="mh">0x00000000</span>  <span class="n">LBEG</span>    <span class="p">:</span> <span class="mh">0x4000c46c</span>  <span class="n">LEND</span>    <span class="p">:</span> <span class="mh">0x4000c477</span>  <span class="n">LCOUNT</span>  <span class="p">:</span> <span class="mh">0xffffffff</span>

<span class="n">Backtrace</span><span class="p">:</span> <span class="mh">0x400e14ed</span><span class="p">:</span><span class="mh">0x3ffb5030</span> <span class="mh">0x400d0802</span><span class="p">:</span><span class="mh">0x3ffb5050</span>
<span class="mh">0x400e14ed</span><span class="p">:</span> <span class="n">app_main</span> <span class="n">at</span> <span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">esp</span><span class="o">/</span><span class="n">example</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">cpp</span><span class="p">:</span><span class="mi">36</span>

<span class="mh">0x400d0802</span><span class="p">:</span> <span class="n">main_task</span> <span class="n">at</span> <span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">esp</span><span class="o">/</span><span class="n">esp</span><span class="o">-</span><span class="n">idf</span><span class="o">/</span><span class="n">components</span><span class="o">/</span><span class="n">esp32</span><span class="o">/</span><span class="n">cpu_start</span><span class="o">.</span><span class="n">c</span><span class="p">:</span><span class="mi">470</span>
</pre></div>
</div>
<p>To find the location where a fatal error has happened, look at the lines which follow the “Backtrace” line. Fatal error location is the top line, and subsequent lines show the call stack.</p>
</div>
<div class="section" id="gdb-stub">
<h2>GDB Stub<a class="headerlink" href="fatal-errors.html#gdb-stub" title="Permalink to this headline">¶</a></h2>
<p>If <code class="docutils literal notranslate"><span class="pre">CONFIG_ESP32_PANIC_GDBSTUB</span></code> option is enabled, panic handler will not reset the chip when fatal error happens. Instead, it will start GDB remote protocol server, commonly referred to as GDB Stub. When this happens, GDB instance running on the host computer can be instructed to connect to the ESP32 UART port.</p>
<p>If <a class="reference internal" href="tools/idf-monitor.html"><span class="doc">IDF Monitor</span></a> is used, GDB is started automatically when GDB Stub prompt is detected on the UART. The output would look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Entering gdb stub now.
$T0b#e6GNU gdb (crosstool-NG crosstool-ng-1.22.0-80-gff1f415) 7.10
Copyright (C) 2015 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot;
and &quot;show warranty&quot; for details.
This GDB was configured as &quot;--host=x86_64-build_apple-darwin16.3.0 --target=xtensa-esp32-elf&quot;.
Type &quot;show configuration&quot; for configuration details.
For bug reporting instructions, please see:
&lt;http://www.gnu.org/software/gdb/bugs/&gt;.
Find the GDB manual and other documentation resources online at:
&lt;http://www.gnu.org/software/gdb/documentation/&gt;.
For help, type &quot;help&quot;.
Type &quot;apropos word&quot; to search for commands related to &quot;word&quot;...
Reading symbols from /Users/user/esp/example/build/example.elf...done.
Remote debugging using /dev/cu.usbserial-31301
0x400e1b41 in app_main ()
    at /Users/user/esp/example/main/main.cpp:36
36      *((int*) 0) = 0;
(gdb)
</pre></div>
</div>
<p>GDB prompt can be used to inspect CPU registers, local and static variables, and arbitrary locations in memory. It is not possible to set breakpoints, change PC, or continue execution. To reset the program, exit GDB and perform external reset: Ctrl-T Ctrl-R in IDF Monitor, or using external reset button on the development board.</p>
</div>
<div class="section" id="guru-meditation-errors">
<h2>Guru Meditation Errors<a class="headerlink" href="fatal-errors.html#guru-meditation-errors" title="Permalink to this headline">¶</a></h2>
<p>This section explains the meaning of different error causes, printed in parens after <code class="docutils literal notranslate"><span class="pre">Guru</span> <span class="pre">Meditation</span> <span class="pre">Error:</span> <span class="pre">Core</span> <span class="pre">panic'ed</span></code> message.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">See <a class="reference external" href="https://en.wikipedia.org/wiki/Guru_Meditation">Wikipedia article</a> for historical origins of “Guru Meditation”.</p>
</div>
<div class="section" id="illegalinstruction">
<h3>IllegalInstruction<a class="headerlink" href="fatal-errors.html#illegalinstruction" title="Permalink to this headline">¶</a></h3>
<p>This CPU exception indicates that the instruction which was executed was not a valid instruction.
Most common reasons for this error include:</p>
<ul class="simple">
<li>FreeRTOS task function has returned. In FreeRTOS, if task function needs to terminate, it should call <a class="reference internal" href="../api-reference/system/freertos.html#_CPPv411vTaskDelete12TaskHandle_t" title="vTaskDelete"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">vTaskDelete()</span></code></a> function and delete itself, instead of returning.</li>
<li>Failure to load next instruction from SPI flash. This usually happens if:<ul>
<li>Application has reconfigured SPI flash pins as some other function (GPIO, UART, etc.). Consult Hardware Design Guidelines and the Datasheet for the chip or module for details about SPI flash pins.</li>
<li>Some external device was accidentally connected to SPI flash pins, and has interfered with communication between ESP32 and SPI flash.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="instrfetchprohibited">
<h3>InstrFetchProhibited<a class="headerlink" href="fatal-errors.html#instrfetchprohibited" title="Permalink to this headline">¶</a></h3>
<p>This CPU exception indicates that CPU could not load an instruction because the the address of the instruction did not belong to a valid region in instruction RAM or ROM.</p>
<p>Usually this means an attempt to call a function pointer, which does not point to valid code. <code class="docutils literal notranslate"><span class="pre">PC</span></code> (Program Counter) register can be used as an indicator: it will be zero or will contain garbage value (not <code class="docutils literal notranslate"><span class="pre">0x4xxxxxxx</span></code>).</p>
</div>
<div class="section" id="loadprohibited-storeprohibited">
<h3>LoadProhibited, StoreProhibited<a class="headerlink" href="fatal-errors.html#loadprohibited-storeprohibited" title="Permalink to this headline">¶</a></h3>
<p>This CPU exception happens when application attempts to read from or write to an invalid memory location. The address which was written/read is found in <code class="docutils literal notranslate"><span class="pre">EXCVADDR</span></code> register in the register dump. If this address is zero, it usually means that application attempted to dereference a NULL pointer. If this address is close to zero, it usually means that application attempted to access member of a structure, but the pointer to the structure was NULL. If this address is something else (garbage value, not in <code class="docutils literal notranslate"><span class="pre">0x3fxxxxxx</span></code> - <code class="docutils literal notranslate"><span class="pre">0x6xxxxxxx</span></code> range), it likely means that the pointer used to access the data was either not initialized or was corrupted.</p>
</div>
<div class="section" id="integerdividebyzero">
<h3>IntegerDivideByZero<a class="headerlink" href="fatal-errors.html#integerdividebyzero" title="Permalink to this headline">¶</a></h3>
<p>Application has attempted to do integer division by zero.</p>
</div>
<div class="section" id="loadstorealignment">
<h3>LoadStoreAlignment<a class="headerlink" href="fatal-errors.html#loadstorealignment" title="Permalink to this headline">¶</a></h3>
<p>Application has attempted to read or write memory location, and address alignment did not match load/store size. For example, 32-bit load can only be done from 4-byte aligned address, and 16-bit load can only be done from a 2-byte aligned address.</p>
</div>
<div class="section" id="loadstoreerror">
<h3>LoadStoreError<a class="headerlink" href="fatal-errors.html#loadstoreerror" title="Permalink to this headline">¶</a></h3>
<p>Application has attempted to do a 8- or 16- bit load/store from a memory region which only supports 32-bit loads/stores. For example, dereferencing a <code class="docutils literal notranslate"><span class="pre">char*</span></code> pointer which points into intruction memory will result in such an error.</p>
</div>
<div class="section" id="unhandled-debug-exception">
<h3>Unhandled debug exception<a class="headerlink" href="fatal-errors.html#unhandled-debug-exception" title="Permalink to this headline">¶</a></h3>
<p>This will usually be followed by a message like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Debug</span> <span class="n">exception</span> <span class="n">reason</span><span class="p">:</span> <span class="n">Stack</span> <span class="n">canary</span> <span class="n">watchpoint</span> <span class="n">triggered</span> <span class="p">(</span><span class="n">task_name</span><span class="p">)</span>
</pre></div>
</div>
<p>This error indicates that application has written past the end of the stack of <code class="docutils literal notranslate"><span class="pre">task_name</span></code> task. Note that not every stack overflow is guaranteed to trigger this error. It is possible that the task writes to stack beyond the stack canary location, in which case the watchpoint will not be triggered.</p>
</div>
<div class="section" id="interrupt-wdt-timeout-on-cpu0-cpu1">
<h3>Interrupt wdt timeout on CPU0 / CPU1<a class="headerlink" href="fatal-errors.html#interrupt-wdt-timeout-on-cpu0-cpu1" title="Permalink to this headline">¶</a></h3>
<p>Indicates that interrupt watchdog timeout has occured. See <a class="reference internal" href="../api-reference/system/wdts.html"><span class="doc">Watchdogs</span></a> for more information.</p>
</div>
<div class="section" id="cache-disabled-but-cached-memory-region-accessed">
<h3>Cache disabled but cached memory region accessed<a class="headerlink" href="fatal-errors.html#cache-disabled-but-cached-memory-region-accessed" title="Permalink to this headline">¶</a></h3>
<p>In some situations ESP-IDF will temporarily disable access to external SPI Flash and SPI RAM via caches. For example, this happens with spi_flash APIs are used to read/write/erase/mmap regions of SPI Flash. In these situations, tasks are suspended, and interrupt handlers not registered with <code class="docutils literal notranslate"><span class="pre">ESP_INTR_FLAG_IRAM</span></code> are disabled. Make sure that any interrupt handlers registered with this flag have all the code and data in IRAM/DRAM. Refer to the <a class="reference internal" href="../api-reference/storage/spi_flash.html#iram-safe-interrupt-handlers"><span class="std std-ref">SPI flash API documentation</span></a> for more details.</p>
</div>
</div>
<div class="section" id="other-fatal-errors">
<h2>Other Fatal Errors<a class="headerlink" href="fatal-errors.html#other-fatal-errors" title="Permalink to this headline">¶</a></h2>
<div class="section" id="brownout">
<h3>Brownout<a class="headerlink" href="fatal-errors.html#brownout" title="Permalink to this headline">¶</a></h3>
<p>ESP32 has a built-in brownout detector, which is enabled by default. Brownout detector can trigger system reset if supply voltage goes below safe level. Brownout detector can be configured using <a class="reference internal" href="../api-reference/kconfig.html#config-esp32-brownout-det"><span class="std std-ref">CONFIG_ESP32_BROWNOUT_DET</span></a> and <a class="reference internal" href="../api-reference/kconfig.html#config-esp32-brownout-det-lvl-sel"><span class="std std-ref">CONFIG_ESP32_BROWNOUT_DET_LVL_SEL</span></a> options.
When brownout detector triggers, the following message is printed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Brownout</span> <span class="n">detector</span> <span class="n">was</span> <span class="n">triggered</span>
</pre></div>
</div>
<p>Chip is reset after the message is printed.</p>
<p>Note that if supply voltage is dropping at a fast rate, only part of the message may be seen on the console.</p>
</div>
<div class="section" id="corrupt-heap">
<h3>Corrupt Heap<a class="headerlink" href="fatal-errors.html#corrupt-heap" title="Permalink to this headline">¶</a></h3>
<p>ESP-IDF heap implementation contains a number of run-time checks of heap structure. Additional checks (“Heap Poisoning”) can be enabled in menuconfig. If one of the checks fails, message similar to the following will be printed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CORRUPT</span> <span class="n">HEAP</span><span class="p">:</span> <span class="n">Bad</span> <span class="n">tail</span> <span class="n">at</span> <span class="mh">0x3ffe270a</span><span class="o">.</span> <span class="n">Expected</span> <span class="mh">0xbaad5678</span> <span class="n">got</span> <span class="mh">0xbaac5678</span>
<span class="n">assertion</span> <span class="s2">&quot;head != NULL&quot;</span> <span class="n">failed</span><span class="p">:</span> <span class="n">file</span> <span class="s2">&quot;/Users/user/esp/esp-idf/components/heap/multi_heap_poisoning.c&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">201</span><span class="p">,</span> <span class="n">function</span><span class="p">:</span> <span class="n">multi_heap_free</span>
<span class="n">abort</span><span class="p">()</span> <span class="n">was</span> <span class="n">called</span> <span class="n">at</span> <span class="n">PC</span> <span class="mh">0x400dca43</span> <span class="n">on</span> <span class="n">core</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Consult <a class="reference internal" href="../api-reference/system/heap_debug.html"><span class="doc">Heap Memory Debugging</span></a> documentation for further information.</p>
</div>
<div class="section" id="stack-smashing">
<h3>Stack Smashing<a class="headerlink" href="fatal-errors.html#stack-smashing" title="Permalink to this headline">¶</a></h3>
<p>Stack smashing protection (based on GCC <code class="docutils literal notranslate"><span class="pre">-fstack-protector*</span></code> flags) can be enabled in ESP-IDF using <a class="reference internal" href="../api-reference/kconfig.html#config-compiler-stack-check-mode"><span class="std std-ref">CONFIG_COMPILER_STACK_CHECK_MODE</span></a> option. If stack smashing is detected, message similar to the following will be printed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Stack smashing protect failure!

abort() was called at PC 0x400d2138 on core 0

Backtrace: 0x4008e6c0:0x3ffc1780 0x4008e8b7:0x3ffc17a0 0x400d2138:0x3ffc17c0 0x400e79d5:0x3ffc17e0 0x400e79a7:0x3ffc1840 0x400e79df:0x3ffc18a0 0x400e2235:0x3ffc18c0 0x400e1916:0x3ffc18f0 0x400e19cd:0x3ffc1910 0x400e1a11:0x3ffc1930 0x400e1bb2:0x3ffc1950 0x400d2c44:0x3ffc1a80
0
</pre></div>
</div>
<p>The backtrace should point to the function where stack smashing has occured. Check the function code for unbounded access to local arrays.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../security/flash-encryption.html" class="btn btn-neutral float-right" title="Flash Encryption" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="external-ram.html" class="btn btn-neutral float-left" title="Support for external RAM" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016 - 2019, Espressif Systems (Shanghai) CO., LTD
      
        <span class="commit">
          Revision <code>f9108063</code>.
        </span>
      

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  



  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
   

</body>
</html>