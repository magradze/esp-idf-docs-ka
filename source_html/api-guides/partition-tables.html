

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Partition Tables &mdash; ESP-IDF Programming Guide v4.1-dev-2071-gf91080637 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="https://media.readthedocs.com/javascript/readthedocs-doc-embed.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="RF calibration" href="RF_calibration.html" />
    <link rel="prev" title="lwIP" href="lwip.html" /> 

<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="https://docs.espressif.com/projects/esp-idf/en/latest/api-guides/partition-tables.html" />

<link rel="stylesheet" href="https://media.readthedocs.com/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="../_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = "api-guides/partition-tables"
READTHEDOCS_DATA['source_suffix'] = ".rst"
</script>

<script type="text/javascript" src="https://media.readthedocs.com/javascript/readthedocs-analytics.js"></script>

<!-- end RTD <extrahead> -->
<script async type="text/javascript" src="../../../../../_/static/javascript/readthedocs-addons.js"></script><meta name="readthedocs-project-slug" content="espressif-esp-idf" /><meta name="readthedocs-version-slug" content="latest" /><meta name="readthedocs-resolver-filename" content="/api-guides/partition-tables.html" /><meta name="readthedocs-http-status" content="200" /></head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> ESP-IDF Programming Guide
          

          
            
            <img src="../_static/espressif-logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../get-started/index.html">Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api-reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hw-reference/index.html">H/W Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../esp32s2.html">ESP32-S2 Preview Support</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">API Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="app_trace.html">Application Level Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="blufi.html">BluFi</a></li>
<li class="toctree-l2"><a class="reference internal" href="bootloader.html">Bootloader</a></li>
<li class="toctree-l2"><a class="reference internal" href="build-system.html">Build System</a></li>
<li class="toctree-l2"><a class="reference internal" href="build-system-legacy.html">Build System (Legacy GNU Make)</a></li>
<li class="toctree-l2"><a class="reference internal" href="console.html">Console Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="deep-sleep-stub.html">Deep Sleep Wake Stubs</a></li>
<li class="toctree-l2"><a class="reference internal" href="error-handling.html">Error Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="esp-ble-mesh/ble-mesh-index.html">ESP-BLE-MESH</a></li>
<li class="toctree-l2"><a class="reference internal" href="mesh.html">ESP-MESH (Wi-Fi)</a></li>
<li class="toctree-l2"><a class="reference internal" href="core_dump.html">ESP32 Core Dump</a></li>
<li class="toctree-l2"><a class="reference internal" href="event-handling.html">Event Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="external-ram.html">External SPI-connected RAM</a></li>
<li class="toctree-l2"><a class="reference internal" href="fatal-errors.html">Fatal Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/flash-encryption.html">Flash Encryption</a></li>
<li class="toctree-l2"><a class="reference internal" href="freertos-smp.html">FreeRTOS SMP Changes</a></li>
<li class="toctree-l2"><a class="reference internal" href="general-notes.html">General Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="hlinterrupts.html">High Level Interrupts</a></li>
<li class="toctree-l2"><a class="reference internal" href="jtag-debugging/index.html">JTAG Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="linker-script-generation.html">Linker Script Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="lwip.html">lwIP TCP/IP Stack</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="partition-tables.html#">Partition Tables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="partition-tables.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="partition-tables.html#built-in-partition-tables">Built-in Partition Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="partition-tables.html#creating-custom-tables">Creating Custom Tables</a><ul>
<li class="toctree-l4"><a class="reference internal" href="partition-tables.html#name-field">Name field</a></li>
<li class="toctree-l4"><a class="reference internal" href="partition-tables.html#type-field">Type field</a></li>
<li class="toctree-l4"><a class="reference internal" href="partition-tables.html#subtype">SubType</a></li>
<li class="toctree-l4"><a class="reference internal" href="partition-tables.html#offset-size">Offset &amp; Size</a></li>
<li class="toctree-l4"><a class="reference internal" href="partition-tables.html#flags">Flags</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="partition-tables.html#generating-binary-partition-table">Generating Binary Partition Table</a><ul>
<li class="toctree-l4"><a class="reference internal" href="partition-tables.html#md5-checksum">MD5 checksum</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="partition-tables.html#flashing-the-partition-table">Flashing the partition table</a></li>
<li class="toctree-l3"><a class="reference internal" href="partition-tables.html#partition-tool-parttool-py">Partition Tool (parttool.py)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="partition-tables.html#python-api">Python API</a></li>
<li class="toctree-l4"><a class="reference internal" href="partition-tables.html#command-line-interface">Command-line Interface</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="RF_calibration.html">RF Calibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="romconsole.html">ROM debug console</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/secure-boot.html">Secure Boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="thread-local-storage.html">Thread Local Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools/index.html">Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="ulp.html">ULP Coprocessor</a></li>
<li class="toctree-l2"><a class="reference internal" href="ulp-legacy.html">ULP Coprocessor (Legacy GNU Make)</a></li>
<li class="toctree-l2"><a class="reference internal" href="unit-tests-legacy.html">Unit Testing (Legacy GNU Make)</a></li>
<li class="toctree-l2"><a class="reference internal" href="unit-tests.html">Unit Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="wifi.html">WiFi Driver</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../libraries-and-frameworks/index.html">Libraries and Frameworks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/index.html">Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../versions.html">Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../COPYRIGHT.html">Copyrights</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../languages.html">语言/Languages</a></li>
<li class="toctree-l1"><a class="reference external" href="https://readthedocs.com/projects/espressif-esp-idf/downloads/">Guide Downloads</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ESP-IDF Programming Guide</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">API Guides</a> &raquo;</li>
        
      <li>Partition Tables</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/espressif/esp-idf/blob/master/docs/en/api-guides/partition-tables.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="partition-tables">
<h1>Partition Tables<a class="headerlink" href="partition-tables.html#partition-tables" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://espressif-docs.readthedocs-hosted.com/projects/esp-idf/zh_CN/latest/api-guides/partition-tables.html">[中文]</a></p>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="partition-tables.html#overview" title="Permalink to this headline">¶</a></h2>
<p>A single ESP32’s flash can contain multiple apps, as well as many different kinds of data (calibration data, filesystems, parameter storage, etc). For this reason a partition table is flashed to (<a class="reference internal" href="../api-reference/kconfig.html#config-partition-table-offset"><span class="std std-ref">default offset</span></a>) 0x8000 in the flash.</p>
<p>Partition table length is 0xC00 bytes (maximum 95 partition table entries). An MD5 checksum, which is used for checking the integrity of the partition table, is appended after the table data. If the partition table is signed due to <cite>secure boot</cite>, the signature is appended after the partition table.</p>
<p>Each entry in the partition table has a name (label), type (app, data, or something else), subtype and the offset in flash where the partition is loaded.</p>
<p>The simplest way to use the partition table is to open the project configuration menu (<code class="docutils literal notranslate"><span class="pre">idf.py</span> <span class="pre">menuconfig</span></code>) and choose one of the simple predefined partition tables under <a class="reference internal" href="../api-reference/kconfig.html#config-partition-table-type"><span class="std std-ref">CONFIG_PARTITION_TABLE_TYPE</span></a>:</p>
<ul class="simple">
<li>“Single factory app, no OTA”</li>
<li>“Factory app, two OTA definitions”</li>
</ul>
<p>In both cases the factory app is flashed at offset 0x10000. If you execute <cite>idf.py partition_table</cite> then it will print a summary of the partition table.</p>
</div>
<div class="section" id="built-in-partition-tables">
<h2>Built-in Partition Tables<a class="headerlink" href="partition-tables.html#built-in-partition-tables" title="Permalink to this headline">¶</a></h2>
<p>Here is the summary printed for the “Single factory app, no OTA” configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Espressif ESP32 Partition Table</span>
<span class="c1"># Name,   Type, SubType, Offset,  Size, Flags</span>
<span class="n">nvs</span><span class="p">,</span>      <span class="n">data</span><span class="p">,</span> <span class="n">nvs</span><span class="p">,</span>     <span class="mh">0x9000</span><span class="p">,</span>  <span class="mh">0x6000</span><span class="p">,</span>
<span class="n">phy_init</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">phy</span><span class="p">,</span>     <span class="mh">0xf000</span><span class="p">,</span>  <span class="mh">0x1000</span><span class="p">,</span>
<span class="n">factory</span><span class="p">,</span>  <span class="n">app</span><span class="p">,</span>  <span class="n">factory</span><span class="p">,</span> <span class="mh">0x10000</span><span class="p">,</span> <span class="mi">1</span><span class="n">M</span><span class="p">,</span>
</pre></div>
</div>
<ul class="simple">
<li>At a 0x10000 (64KB) offset in the flash is the app labelled “factory”. The bootloader will run this app by default.</li>
<li>There are also two data regions defined in the partition table for storing NVS library partition and PHY init data.</li>
</ul>
<p>Here is the summary printed for the “Factory app, two OTA definitions” configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Espressif ESP32 Partition Table</span>
<span class="c1"># Name,   Type, SubType, Offset,  Size, Flags</span>
<span class="n">nvs</span><span class="p">,</span>      <span class="n">data</span><span class="p">,</span> <span class="n">nvs</span><span class="p">,</span>     <span class="mh">0x9000</span><span class="p">,</span>  <span class="mh">0x4000</span><span class="p">,</span>
<span class="n">otadata</span><span class="p">,</span>  <span class="n">data</span><span class="p">,</span> <span class="n">ota</span><span class="p">,</span>     <span class="mh">0xd000</span><span class="p">,</span>  <span class="mh">0x2000</span><span class="p">,</span>
<span class="n">phy_init</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">phy</span><span class="p">,</span>     <span class="mh">0xf000</span><span class="p">,</span>  <span class="mh">0x1000</span><span class="p">,</span>
<span class="n">factory</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>       <span class="mh">0x10000</span><span class="p">,</span> <span class="mi">1</span><span class="n">M</span><span class="p">,</span>
<span class="n">ota_0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="n">ota_0</span><span class="p">,</span>  <span class="mh">0x110000</span><span class="p">,</span> <span class="mi">1</span><span class="n">M</span><span class="p">,</span>
<span class="n">ota_1</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="n">ota_1</span><span class="p">,</span>  <span class="mh">0x210000</span><span class="p">,</span> <span class="mi">1</span><span class="n">M</span><span class="p">,</span>
</pre></div>
</div>
<ul class="simple">
<li>There are now three app partition definitions. The type of the factory app (at 0x10000) and the next two “OTA” apps are all set to “app”, but their subtypes are different.</li>
<li>There is also a new “otadata” slot, which holds the data for OTA updates. The bootloader consults this data in order to know which app to execute. If “ota data” is empty, it will execute the factory app.</li>
</ul>
</div>
<div class="section" id="creating-custom-tables">
<h2>Creating Custom Tables<a class="headerlink" href="partition-tables.html#creating-custom-tables" title="Permalink to this headline">¶</a></h2>
<p>If you choose “Custom partition table CSV” in menuconfig then you can also enter the name of a CSV file (in the project directory) to use for your partition table. The CSV file can describe any number of definitions for the table you need.</p>
<p>The CSV format is the same format as printed in the summaries shown above. However, not all fields are required in the CSV. For example, here is the “input” CSV for the OTA partition table:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Name,   Type, SubType,  Offset,   Size,  Flags</span>
<span class="n">nvs</span><span class="p">,</span>      <span class="n">data</span><span class="p">,</span> <span class="n">nvs</span><span class="p">,</span>      <span class="mh">0x9000</span><span class="p">,</span>  <span class="mh">0x4000</span>
<span class="n">otadata</span><span class="p">,</span>  <span class="n">data</span><span class="p">,</span> <span class="n">ota</span><span class="p">,</span>      <span class="mh">0xd000</span><span class="p">,</span>  <span class="mh">0x2000</span>
<span class="n">phy_init</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">phy</span><span class="p">,</span>      <span class="mh">0xf000</span><span class="p">,</span>  <span class="mh">0x1000</span>
<span class="n">factory</span><span class="p">,</span>  <span class="n">app</span><span class="p">,</span>  <span class="n">factory</span><span class="p">,</span>  <span class="mh">0x10000</span><span class="p">,</span>  <span class="mi">1</span><span class="n">M</span>
<span class="n">ota_0</span><span class="p">,</span>    <span class="n">app</span><span class="p">,</span>  <span class="n">ota_0</span><span class="p">,</span>    <span class="p">,</span>         <span class="mi">1</span><span class="n">M</span>
<span class="n">ota_1</span><span class="p">,</span>    <span class="n">app</span><span class="p">,</span>  <span class="n">ota_1</span><span class="p">,</span>    <span class="p">,</span>         <span class="mi">1</span><span class="n">M</span>
<span class="n">nvs_key</span><span class="p">,</span>  <span class="n">data</span><span class="p">,</span> <span class="n">nvs_keys</span><span class="p">,</span> <span class="p">,</span>        <span class="mh">0x1000</span>
</pre></div>
</div>
<ul class="simple">
<li>Whitespace between fields is ignored, and so is any line starting with # (comments).</li>
<li>Each non-comment line in the CSV file is a partition definition.</li>
<li>The “Offset” field for each partition is empty. The gen_esp32part.py tool fills in each blank offset, starting after the partition table and making sure each partition is aligned correctly.</li>
</ul>
<div class="section" id="name-field">
<h3>Name field<a class="headerlink" href="partition-tables.html#name-field" title="Permalink to this headline">¶</a></h3>
<p>Name field can be any meaningful name. It is not significant to the ESP32. Names longer than 16 characters will be truncated.</p>
</div>
<div class="section" id="type-field">
<h3>Type field<a class="headerlink" href="partition-tables.html#type-field" title="Permalink to this headline">¶</a></h3>
<p>Partition type field can be specified as app (0) or data (1). Or it can be a number 0-254 (or as hex 0x00-0xFE). Types 0x00-0x3F are reserved for esp-idf core functions.</p>
<p>If your application needs to store data, please add a custom partition type in the range 0x40-0xFE.</p>
<p>The bootloader ignores any partition types other than app (0) &amp; data (1).</p>
</div>
<div class="section" id="subtype">
<h3>SubType<a class="headerlink" href="partition-tables.html#subtype" title="Permalink to this headline">¶</a></h3>
<p>The 8-bit subtype field is specific to a given partition type. esp-idf currently only specifies the meaning of the subtype field for “app” and “data” partition types.</p>
<ul class="simple">
<li>When type is “app”, the subtype field can be specified as factory (0), ota_0 (0x10) … ota_15 (0x1F) or test (0x20).<ul>
<li>factory (0) is the default app partition. The bootloader will execute the factory app unless there it sees a partition of type data/ota, in which case it reads this partition to determine which OTA image to boot.<ul>
<li>OTA never updates the factory partition.</li>
<li>If you want to conserve flash usage in an OTA project, you can remove the factory partition and use ota_0 instead.</li>
</ul>
</li>
<li>ota_0 (0x10) … ota_15 (0x1F) are the OTA app slots. Refer to the <a class="reference internal" href="../api-reference/system/ota.html"><span class="doc">OTA documentation</span></a> for more details, which then use the OTA data partition to configure which app slot the bootloader should boot. If using OTA, an application should have at least two OTA application slots (ota_0 &amp; ota_1). Refer to the <a class="reference internal" href="../api-reference/system/ota.html"><span class="doc">OTA documentation</span></a> for more details.</li>
<li>test (0x20) is a reserved subtype for factory test procedures. It will be used as the fallback boot partition if no other valid app partition is found. It is also possible to configure the bootloader to read a GPIO input during each boot, and boot this partition if the GPIO is held low, see <a class="reference internal" href="bootloader.html#bootloader-boot-from-test-firmware"><span class="std std-ref">Boot from TEST firmware</span></a>.</li>
</ul>
</li>
<li>When type is “data”, the subtype field can be specified as ota (0), phy (1), nvs (2), or nvs_keys (4).<ul>
<li>ota (0) is the <a class="reference internal" href="../api-reference/system/ota.html#ota-data-partition"><span class="std std-ref">OTA data partition</span></a> which stores information about the currently selected OTA application. This partition should be 0x2000 bytes in size. Refer to the <a class="reference internal" href="../api-reference/system/ota.html#ota-data-partition"><span class="std std-ref">OTA documentation</span></a> for more details.</li>
<li>phy (1) is for storing PHY initialisation data. This allows PHY to be configured per-device, instead of in firmware.<ul>
<li>In the default configuration, the phy partition is not used and PHY initialisation data is compiled into the app itself. As such, this partition can be removed from the partition table to save space.</li>
<li>To load PHY data from this partition, open the project configuration menu (<code class="docutils literal notranslate"><span class="pre">idf.py</span> <span class="pre">menuconfig</span></code>) and enable <a class="reference internal" href="../api-reference/kconfig.html#config-esp32-phy-init-data-in-partition"><span class="std std-ref">CONFIG_ESP32_PHY_INIT_DATA_IN_PARTITION</span></a> option. You will also need to flash your devices with phy init data as the esp-idf build system does not do this automatically.</li>
</ul>
</li>
<li>nvs (2) is for the <a class="reference internal" href="../api-reference/storage/nvs_flash.html"><span class="doc">Non-Volatile Storage (NVS) API</span></a>.<ul>
<li>NVS is used to store per-device PHY calibration data (different to initialisation data).</li>
<li>NVS is used to store WiFi data if the <a class="reference internal" href="../api-reference/network/esp_wifi.html"><span class="doc">esp_wifi_set_storage(WIFI_STORAGE_FLASH)</span></a> initialisation function is used.</li>
<li>The NVS API can also be used for other application data.</li>
<li>It is strongly recommended that you include an NVS partition of at least 0x3000 bytes in your project.</li>
<li>If using NVS API to store a lot of data, increase the NVS partition size from the default 0x6000 bytes.</li>
</ul>
</li>
<li>nvs_keys (4) is for the NVS key partition. See <a class="reference internal" href="../api-reference/storage/nvs_flash.html"><span class="doc">Non-Volatile Storage (NVS) API</span></a> for more details.<ul>
<li>It is used to store NVS encryption keys when <cite>NVS Encryption</cite> feature is enabled.</li>
<li>The size of this partition should be 4096 bytes (minimum partition size).</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Other data subtypes are reserved for future esp-idf uses.</p>
</div>
<div class="section" id="offset-size">
<h3>Offset &amp; Size<a class="headerlink" href="partition-tables.html#offset-size" title="Permalink to this headline">¶</a></h3>
<p>Partitions with blank offsets will start after the previous partition, or after the partition table in the case of the first partition.</p>
<p>App partitions have to be at offsets aligned to 0x10000 (64K). If you leave the offset field blank,  <code class="docutils literal notranslate"><span class="pre">gen_esp32part.py</span></code> will automatically align the partition. If you specify an unaligned offset for an app partition, the tool will return an error.</p>
<p>Sizes and offsets can be specified as decimal numbers, hex numbers with the prefix 0x, or size multipliers K or M (1024 and 1024*1024 bytes).</p>
<p>If you want the partitions in the partition table to work with any starting offset (<a class="reference internal" href="../api-reference/kconfig.html#config-partition-table-offset"><span class="std std-ref">CONFIG_PARTITION_TABLE_OFFSET</span></a>) of the table itself, leave the offset field (in CSV file) for all partitions blank. Similarly, if changing the partition table offset then be aware that all blank partition offsets may change to match, and that any fixed offsets may now collide with the partition table (causing an error).</p>
</div>
<div class="section" id="flags">
<h3>Flags<a class="headerlink" href="partition-tables.html#flags" title="Permalink to this headline">¶</a></h3>
<p>Only one flag is currently supported, <code class="docutils literal notranslate"><span class="pre">encrypted</span></code>. If this field is set to <code class="docutils literal notranslate"><span class="pre">encrypted</span></code>, this partition will be encrypted if <a class="reference internal" href="../security/flash-encryption.html"><span class="doc">Flash Encryption</span></a> is enabled.</p>
<p>(Note that <code class="docutils literal notranslate"><span class="pre">app</span></code> type partitions will always be encrypted, regardless of whether this flag is set or not.)</p>
</div>
</div>
<div class="section" id="generating-binary-partition-table">
<h2>Generating Binary Partition Table<a class="headerlink" href="partition-tables.html#generating-binary-partition-table" title="Permalink to this headline">¶</a></h2>
<p>The partition table which is flashed to the ESP32 is in a binary format, not CSV. The tool <a class="reference external" href="https://github.com/espressif/esp-idf/blob/f91080637/components/partition_table/gen_esp32part.py">partition_table/gen_esp32part.py</a> is used to convert between CSV and binary formats.</p>
<p>If you configure the partition table CSV name in the project configuration (<code class="docutils literal notranslate"><span class="pre">idf.py</span> <span class="pre">menuconfig</span></code>) and then build the project or run <code class="docutils literal notranslate"><span class="pre">idf.py</span> <span class="pre">partition_table</span></code>, this conversion is done as part of the build process.</p>
<p>To convert CSV to Binary manually:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">gen_esp32part</span><span class="o">.</span><span class="n">py</span> <span class="n">input_partitions</span><span class="o">.</span><span class="n">csv</span> <span class="n">binary_partitions</span><span class="o">.</span><span class="n">bin</span>
</pre></div>
</div>
<p>To convert binary format back to CSV manually:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">gen_esp32part</span><span class="o">.</span><span class="n">py</span> <span class="n">binary_partitions</span><span class="o">.</span><span class="n">bin</span> <span class="n">input_partitions</span><span class="o">.</span><span class="n">csv</span>
</pre></div>
</div>
<p>To display the contents of a binary partition table on stdout (this is how the summaries displayed when running <code class="docutils literal notranslate"><span class="pre">idf.py</span> <span class="pre">partition_table</span></code> are generated:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">gen_esp32part</span><span class="o">.</span><span class="n">py</span> <span class="n">binary_partitions</span><span class="o">.</span><span class="n">bin</span>
</pre></div>
</div>
<div class="section" id="md5-checksum">
<h3>MD5 checksum<a class="headerlink" href="partition-tables.html#md5-checksum" title="Permalink to this headline">¶</a></h3>
<p>The binary format of the partition table contains an MD5 checksum computed based on the partition table. This checksum is used for checking the integrity of the partition table during the boot.</p>
<p>The MD5 checksum generation can be disabled by the <code class="docutils literal notranslate"><span class="pre">--disable-md5sum</span></code> option of <code class="docutils literal notranslate"><span class="pre">gen_esp32part.py</span></code> or by the <a class="reference internal" href="../api-reference/kconfig.html#config-partition-table-md5"><span class="std std-ref">CONFIG_PARTITION_TABLE_MD5</span></a> option. This is useful for example when one uses a legacy bootloader which cannot process MD5 checksums and the boot fails with the error message <code class="docutils literal notranslate"><span class="pre">invalid</span> <span class="pre">magic</span> <span class="pre">number</span> <span class="pre">0xebeb</span></code>.</p>
</div>
</div>
<div class="section" id="flashing-the-partition-table">
<h2>Flashing the partition table<a class="headerlink" href="partition-tables.html#flashing-the-partition-table" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">idf.py</span> <span class="pre">partition_table-flash</span></code>: will flash the partition table with esptool.py.</li>
<li><code class="docutils literal notranslate"><span class="pre">idf.py</span> <span class="pre">flash</span></code>: Will flash everything including the partition table.</li>
</ul>
<p>A manual flashing command is also printed as part of <code class="docutils literal notranslate"><span class="pre">idf.py</span> <span class="pre">partition_table</span></code> output.</p>
<p>Note that updating the partition table doesn’t erase data that may have been stored according to the old partition table. You can use <code class="docutils literal notranslate"><span class="pre">idf.py</span> <span class="pre">erase_flash</span></code> (or <code class="docutils literal notranslate"><span class="pre">esptool.py</span> <span class="pre">erase_flash</span></code>) to erase the entire flash contents.</p>
</div>
<div class="section" id="partition-tool-parttool-py">
<h2>Partition Tool (parttool.py)<a class="headerlink" href="partition-tables.html#partition-tool-parttool-py" title="Permalink to this headline">¶</a></h2>
<p>The component <cite>partition_table</cite> provides a tool <a class="reference external" href="https://github.com/espressif/esp-idf/blob/f91080637/components/partition_table/parttool.py">parttool.py</a> for performing partition-related operations on a target device. The following operations can be performed using the tool:</p>
<blockquote>
<div><ul class="simple">
<li>reading a partition and saving the contents to a file (read_partition)</li>
<li>writing the contents of a file to a partition (write_partition)</li>
<li>erasing a partition (erase_partition)</li>
<li>retrieving info such as offset and size of a given partition (get_partition_info)</li>
</ul>
</div></blockquote>
<p>The tool can either be imported and used from another Python script or invoked from shell script for users wanting to perform operation programmatically. This is facilitated by the tool’s Python API
and command-line interface, respectively.</p>
<div class="section" id="python-api">
<h3>Python API<a class="headerlink" href="partition-tables.html#python-api" title="Permalink to this headline">¶</a></h3>
<p>Before anything else, make sure that the <cite>parttool</cite> module is imported.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">idf_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;IDF_PATH&quot;</span><span class="p">]</span>  <span class="c1"># get value of IDF_PATH from environment</span>
<span class="n">parttool_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">idf_path</span><span class="p">,</span> <span class="s2">&quot;components&quot;</span><span class="p">,</span> <span class="s2">&quot;partition_table&quot;</span><span class="p">)</span>  <span class="c1"># parttool.py lives in $IDF_PATH/components/partition_table</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parttool_dir</span><span class="p">)</span>  <span class="c1"># this enables Python to find parttool module</span>
<span class="kn">from</span> <span class="nn">parttool</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c1"># import all names inside parttool module</span>
</pre></div>
</div>
<p>The starting point for using the tool’s Python API to do is create a <cite>ParttoolTarget</cite> object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a partool.py target device connected on serial port /dev/ttyUSB1</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">ParttoolTarget</span><span class="p">(</span><span class="s2">&quot;/dev/ttyUSB1&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The created object can now be used to perform operations on the target device:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Erase partition with name &#39;storage&#39;</span>
<span class="n">target</span><span class="o">.</span><span class="n">erase_partition</span><span class="p">(</span><span class="n">PartitionName</span><span class="p">(</span><span class="s2">&quot;storage&quot;</span><span class="p">))</span>

<span class="c1"># Read partition with type &#39;data&#39; and subtype &#39;spiffs&#39; and save to file &#39;spiffs.bin&#39;</span>
<span class="n">target</span><span class="o">.</span><span class="n">read_partition</span><span class="p">(</span><span class="n">PartitionType</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;spiffs&quot;</span><span class="p">),</span> <span class="s2">&quot;spiffs.bin&quot;</span><span class="p">)</span>

<span class="c1"># Write to partition &#39;factory&#39; the contents of a file named &#39;factory.bin&#39;</span>
<span class="n">target</span><span class="o">.</span><span class="n">write_partition</span><span class="p">(</span><span class="n">PartitionName</span><span class="p">(</span><span class="s2">&quot;factory&quot;</span><span class="p">),</span> <span class="s2">&quot;factory.bin&quot;</span><span class="p">)</span>

<span class="c1"># Print the size of default boot partition</span>
<span class="n">storage</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">get_partition_info</span><span class="p">(</span><span class="n">PARTITION_BOOT_DEFAULT</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">storage</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</pre></div>
</div>
<p>The partition to operate on is specified using <cite>PartitionName</cite> or <cite>PartitionType</cite> or PARTITION_BOOT_DEFAULT. As the name implies, these can be used to refer
to partitions of a particular name, type-subtype combination, or the default boot partition.</p>
<p>More information on the Python API is available in the docstrings for the tool.</p>
</div>
<div class="section" id="command-line-interface">
<h3>Command-line Interface<a class="headerlink" href="partition-tables.html#command-line-interface" title="Permalink to this headline">¶</a></h3>
<p>The command-line interface of <cite>parttool.py</cite> has the following structure:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>parttool.py <span class="o">[</span>command-args<span class="o">]</span> <span class="o">[</span>subcommand<span class="o">]</span> <span class="o">[</span>subcommand-args<span class="o">]</span>

- command-args - These are arguments that are needed <span class="k">for</span> executing the main <span class="nb">command</span> <span class="o">(</span>parttool.py<span class="o">)</span>, mostly pertaining to the target device
- subcommand - This is the operation to be performed
- subcommand-args - These are arguments that are specific to the chosen operation
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Erase partition with name &#39;storage&#39;</span>
parttool.py --port <span class="s2">&quot;/dev/ttyUSB1&quot;</span> erase_partition --partition-name<span class="o">=</span>storage

<span class="c1"># Read partition with type &#39;data&#39; and subtype &#39;spiffs&#39; and save to file &#39;spiffs.bin&#39;</span>
parttool.py --port <span class="s2">&quot;/dev/ttyUSB1&quot;</span> read_partition --partition-type<span class="o">=</span>data --partition-subtype<span class="o">=</span>spiffs <span class="s2">&quot;spiffs.bin&quot;</span>

<span class="c1"># Write to partition &#39;factory&#39; the contents of a file named &#39;factory.bin&#39;</span>
parttool.py --port <span class="s2">&quot;/dev/ttyUSB1&quot;</span> write_partition --partition-name<span class="o">=</span>factory <span class="s2">&quot;factory.bin&quot;</span>

<span class="c1"># Print the size of default boot partition</span>
parttool.py --port <span class="s2">&quot;/dev/ttyUSB1&quot;</span> get_partition_info --partition-boot-default --info size
</pre></div>
</div>
<p>More information can be obtained by specifying <cite>–help</cite> as argument:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display possible subcommands and show main command argument descriptions</span>
parttool.py --help

<span class="c1"># Show descriptions for specific subcommand arguments</span>
parttool.py <span class="o">[</span>subcommand<span class="o">]</span> --help
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="RF_calibration.html" class="btn btn-neutral float-right" title="RF calibration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="lwip.html" class="btn btn-neutral float-left" title="lwIP" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016 - 2019, Espressif Systems (Shanghai) CO., LTD
      
        <span class="commit">
          Revision <code>f9108063</code>.
        </span>
      

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  



  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
   

</body>
</html>