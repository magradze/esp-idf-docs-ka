

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Bootloader &mdash; ESP-IDF Programming Guide v4.1-dev-2071-gf91080637 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="https://media.readthedocs.com/javascript/readthedocs-doc-embed.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Build System" href="build-system.html" />
    <link rel="prev" title="BluFi" href="blufi.html" /> 

<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="https://docs.espressif.com/projects/esp-idf/en/latest/api-guides/bootloader.html" />

<link rel="stylesheet" href="https://media.readthedocs.com/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="../_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = "api-guides/bootloader"
READTHEDOCS_DATA['source_suffix'] = ".rst"
</script>

<script type="text/javascript" src="https://media.readthedocs.com/javascript/readthedocs-analytics.js"></script>

<!-- end RTD <extrahead> -->
<script async type="text/javascript" src="../../../../../_/static/javascript/readthedocs-addons.js"></script><meta name="readthedocs-project-slug" content="espressif-esp-idf" /><meta name="readthedocs-version-slug" content="latest" /><meta name="readthedocs-resolver-filename" content="/api-guides/bootloader.html" /><meta name="readthedocs-http-status" content="200" /></head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> ESP-IDF Programming Guide
          

          
            
            <img src="../_static/espressif-logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../get-started/index.html">Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api-reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hw-reference/index.html">H/W Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../esp32s2.html">ESP32-S2 Preview Support</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">API Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="app_trace.html">Application Level Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="blufi.html">BluFi</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="bootloader.html#">Bootloader</a><ul>
<li class="toctree-l3"><a class="reference internal" href="bootloader.html#factory-reset">FACTORY reset</a></li>
<li class="toctree-l3"><a class="reference internal" href="bootloader.html#boot-from-test-firmware">Boot from TEST firmware</a></li>
<li class="toctree-l3"><a class="reference internal" href="bootloader.html#fast-boot-from-deep-sleep">Fast boot from Deep Sleep</a></li>
<li class="toctree-l3"><a class="reference internal" href="bootloader.html#customer-bootloader">Customer bootloader</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="build-system.html">Build System</a></li>
<li class="toctree-l2"><a class="reference internal" href="build-system-legacy.html">Build System (Legacy GNU Make)</a></li>
<li class="toctree-l2"><a class="reference internal" href="console.html">Console Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="deep-sleep-stub.html">Deep Sleep Wake Stubs</a></li>
<li class="toctree-l2"><a class="reference internal" href="error-handling.html">Error Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="esp-ble-mesh/ble-mesh-index.html">ESP-BLE-MESH</a></li>
<li class="toctree-l2"><a class="reference internal" href="mesh.html">ESP-MESH (Wi-Fi)</a></li>
<li class="toctree-l2"><a class="reference internal" href="core_dump.html">ESP32 Core Dump</a></li>
<li class="toctree-l2"><a class="reference internal" href="event-handling.html">Event Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="external-ram.html">External SPI-connected RAM</a></li>
<li class="toctree-l2"><a class="reference internal" href="fatal-errors.html">Fatal Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/flash-encryption.html">Flash Encryption</a></li>
<li class="toctree-l2"><a class="reference internal" href="freertos-smp.html">FreeRTOS SMP Changes</a></li>
<li class="toctree-l2"><a class="reference internal" href="general-notes.html">General Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="hlinterrupts.html">High Level Interrupts</a></li>
<li class="toctree-l2"><a class="reference internal" href="jtag-debugging/index.html">JTAG Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="linker-script-generation.html">Linker Script Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="lwip.html">lwIP TCP/IP Stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="partition-tables.html">Partition Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="RF_calibration.html">RF Calibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="romconsole.html">ROM debug console</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/secure-boot.html">Secure Boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="thread-local-storage.html">Thread Local Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools/index.html">Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="ulp.html">ULP Coprocessor</a></li>
<li class="toctree-l2"><a class="reference internal" href="ulp-legacy.html">ULP Coprocessor (Legacy GNU Make)</a></li>
<li class="toctree-l2"><a class="reference internal" href="unit-tests-legacy.html">Unit Testing (Legacy GNU Make)</a></li>
<li class="toctree-l2"><a class="reference internal" href="unit-tests.html">Unit Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="wifi.html">WiFi Driver</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../libraries-and-frameworks/index.html">Libraries and Frameworks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/index.html">Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../versions.html">Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../COPYRIGHT.html">Copyrights</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../languages.html">语言/Languages</a></li>
<li class="toctree-l1"><a class="reference external" href="https://readthedocs.com/projects/espressif-esp-idf/downloads/">Guide Downloads</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ESP-IDF Programming Guide</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">API Guides</a> &raquo;</li>
        
      <li>Bootloader</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/espressif/esp-idf/blob/master/docs/en/api-guides/bootloader.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="bootloader">
<h1>Bootloader<a class="headerlink" href="bootloader.html#bootloader" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://espressif-docs.readthedocs-hosted.com/projects/esp-idf/zh_CN/latest/api-guides/bootloader.html">[中文]</a></p>
<p>Bootloader performs the following functions:</p>
<ol class="arabic simple">
<li>Minimal initial configuration of internal modules;</li>
<li>Select the application partition to boot, based on the partition table and ota_data (if any);</li>
<li>Load this image to RAM (IRAM &amp; DRAM) and transfer management to it.</li>
</ol>
<p>Bootloader is located at the address <cite>0x1000</cite> in the flash.</p>
<div class="section" id="factory-reset">
<h2>FACTORY reset<a class="headerlink" href="bootloader.html#factory-reset" title="Permalink to this headline">¶</a></h2>
<p>The user can write a basic working firmware and load it into the factory partition.
Next, update the firmware via OTA (over the air). The updated firmware will be loaded into an OTA app partition slot and the OTA data partition is updated to boot from this partition.
If you want to be able to roll back to the factory firmware and clear the settings, then you need to set <a class="reference internal" href="../api-reference/kconfig.html#config-bootloader-factory-reset"><span class="std std-ref">CONFIG_BOOTLOADER_FACTORY_RESET</span></a>.
The factory reset mechanism allows to reset the device to factory settings:</p>
<ul class="simple">
<li>Clear one or more data partitions.</li>
<li>Boot from “factory” partition.</li>
</ul>
<p><a class="reference internal" href="../api-reference/kconfig.html#config-bootloader-data-factory-reset"><span class="std std-ref">CONFIG_BOOTLOADER_DATA_FACTORY_RESET</span></a> allows customers to select which data partitions will be erased when the factory reset is executed.
Can specify the names of partitions through comma-delimited with optional spaces for readability. (Like this: “nvs, phy_init, nvs_custom, …”).
Make sure that the name specified in the partition table and here are the same.
Partitions of type “app” cannot be specified here.</p>
<p><a class="reference internal" href="../api-reference/kconfig.html#config-bootloader-ota-data-erase"><span class="std std-ref">CONFIG_BOOTLOADER_OTA_DATA_ERASE</span></a> - the device will boot from “factory” partition after a factory reset. The OTA data partition will be cleared.</p>
<p><a class="reference internal" href="../api-reference/kconfig.html#config-bootloader-num-pin-factory-reset"><span class="std std-ref">CONFIG_BOOTLOADER_NUM_PIN_FACTORY_RESET</span></a>- number of the GPIO input for factory reset uses to trigger a factory reset, this GPIO must be pulled low on reset to trigger this.</p>
<p><a class="reference internal" href="../api-reference/kconfig.html#config-bootloader-hold-time-gpio"><span class="std std-ref">CONFIG_BOOTLOADER_HOLD_TIME_GPIO</span></a>- this is hold time of GPIO for reset/test mode (by default 5 seconds). The GPIO must be held low continuously for this period of time after reset before a factory reset or test partition boot (as applicable) is performed.</p>
<p>Partition table.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Name,   Type, SubType, Offset,   Size, Flags</span>
<span class="c1"># Note: if you have increased the bootloader size, make sure to update the offsets to avoid overlap</span>
<span class="n">nvs</span><span class="p">,</span>      <span class="n">data</span><span class="p">,</span> <span class="n">nvs</span><span class="p">,</span>     <span class="mh">0x9000</span><span class="p">,</span>   <span class="mh">0x4000</span>
<span class="n">otadata</span><span class="p">,</span>  <span class="n">data</span><span class="p">,</span> <span class="n">ota</span><span class="p">,</span>     <span class="mh">0xd000</span><span class="p">,</span>   <span class="mh">0x2000</span>
<span class="n">phy_init</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">phy</span><span class="p">,</span>     <span class="mh">0xf000</span><span class="p">,</span>   <span class="mh">0x1000</span>
<span class="n">factory</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>       <span class="mh">0x10000</span><span class="p">,</span>  <span class="mi">1</span><span class="n">M</span>
<span class="n">test</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>    <span class="n">test</span><span class="p">,</span>    <span class="p">,</span>         <span class="mi">512</span><span class="n">K</span>
<span class="n">ota_0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="n">ota_0</span><span class="p">,</span>   <span class="p">,</span>         <span class="mi">512</span><span class="n">K</span>
<span class="n">ota_1</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>    <span class="n">ota_1</span><span class="p">,</span>   <span class="p">,</span>         <span class="mi">512</span><span class="n">K</span>
</pre></div>
</div>
</div>
<div class="section" id="boot-from-test-firmware">
<span id="bootloader-boot-from-test-firmware"></span><h2>Boot from TEST firmware<a class="headerlink" href="bootloader.html#boot-from-test-firmware" title="Permalink to this headline">¶</a></h2>
<p>The user can write a special firmware for testing in production, and run it as needed. The partition table also needs a dedicated partition for this testing firmware (See <cite>partition table</cite>).
To trigger a test app you need to set <a class="reference internal" href="../api-reference/kconfig.html#config-bootloader-app-test"><span class="std std-ref">CONFIG_BOOTLOADER_APP_TEST</span></a>.</p>
<p><a class="reference internal" href="../api-reference/kconfig.html#config-bootloader-num-pin-app-test"><span class="std std-ref">CONFIG_BOOTLOADER_NUM_PIN_APP_TEST</span></a> - GPIO number to boot TEST partition. The selected GPIO will be configured as an input with internal pull-up enabled. To trigger a test app, this GPIO must be pulled low on reset.
After the GPIO input is deactivated and the device reboots, the normally configured application will boot (factory or any OTA slot).</p>
<p><a class="reference internal" href="../api-reference/kconfig.html#config-bootloader-hold-time-gpio"><span class="std std-ref">CONFIG_BOOTLOADER_HOLD_TIME_GPIO</span></a> - this is hold time of GPIO for reset/test mode (by default 5 seconds). The GPIO must be held low continuously for this period of time after reset before a factory reset or test partition boot (as applicable) is performed.</p>
</div>
<div class="section" id="fast-boot-from-deep-sleep">
<h2>Fast boot from Deep Sleep<a class="headerlink" href="bootloader.html#fast-boot-from-deep-sleep" title="Permalink to this headline">¶</a></h2>
<p>The bootloader has the <a class="reference internal" href="../api-reference/kconfig.html#config-bootloader-skip-validate-in-deep-sleep"><span class="std std-ref">CONFIG_BOOTLOADER_SKIP_VALIDATE_IN_DEEP_SLEEP</span></a> option which allows to reduce the wake-up time (useful to reduce consumption). This option is available when the <a class="reference internal" href="../api-reference/kconfig.html#config-secure-boot-enabled"><span class="std std-ref">CONFIG_SECURE_BOOT_ENABLED</span></a> option is disabled. Reduction of time is achieved due to the lack of image verification. During the first boot, the bootloader stores the address of the application being launched in the RTC FAST memory. And during the awakening, this address is used for booting without any checks, thus fast loading is achieved.</p>
</div>
<div class="section" id="customer-bootloader">
<h2>Customer bootloader<a class="headerlink" href="bootloader.html#customer-bootloader" title="Permalink to this headline">¶</a></h2>
<p>The current bootloader implementation allows the customer to override it. To do this, you must copy the folder <cite>/esp-idf/components/bootloader</cite> and then edit <cite>/your_project/components/bootloader/subproject/main/bootloader_main.c</cite>.
In the bootloader space, you can not use the drivers and functions from other components. If necessary, then the required functionality should be placed in the folder bootloader (note that this will increase its size).
It is necessary to monitor its size because there can be overlays in memory with a partition table leading to damage. At the moment the bootloader is limited to the partition table from the address <cite>0x8000</cite>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="build-system.html" class="btn btn-neutral float-right" title="Build System" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="blufi.html" class="btn btn-neutral float-left" title="BluFi" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016 - 2019, Espressif Systems (Shanghai) CO., LTD
      
        <span class="commit">
          Revision <code>f9108063</code>.
        </span>
      

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  



  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
   

</body>
</html>