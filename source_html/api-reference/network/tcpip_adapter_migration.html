

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>TCP/IP Adapter Migration Guide &mdash; ESP-IDF Programming Guide v4.1-dev-2071-gf91080637 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script type="text/javascript" src="https://media.readthedocs.com/javascript/readthedocs-doc-embed.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="ESP-NETIF Custom I/O Driver" href="esp_netif_driver.html" />
    <link rel="prev" title="ESP-NETIF" href="esp_netif.html" /> 

<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="https://docs.espressif.com/projects/esp-idf/en/latest/api-reference/network/tcpip_adapter_migration.html" />

<link rel="stylesheet" href="https://media.readthedocs.com/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="../../_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = "api-reference/network/tcpip_adapter_migration"
READTHEDOCS_DATA['source_suffix'] = ".rst"
</script>

<script type="text/javascript" src="https://media.readthedocs.com/javascript/readthedocs-analytics.js"></script>

<!-- end RTD <extrahead> -->
<script async type="text/javascript" src="../../../../../../_/static/javascript/readthedocs-addons.js"></script><meta name="readthedocs-project-slug" content="espressif-esp-idf" /><meta name="readthedocs-version-slug" content="latest" /><meta name="readthedocs-resolver-filename" content="/api-reference/network/tcpip_adapter_migration.html" /><meta name="readthedocs-http-status" content="200" /></head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> ESP-IDF Programming Guide
          

          
            
            <img src="../../_static/espressif-logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../get-started/index.html">Get Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../bluetooth/index.html">Bluetooth</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Networking</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="index.html#wi-fi">Wi-Fi</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#ethernet">Ethernet</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html#ip-network-layer">IP Network Layer</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="esp_netif.html">ESP-NETIF</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="tcpip_adapter_migration.html#">TCP/IP Adapter Migration Guide</a></li>
<li class="toctree-l4"><a class="reference internal" href="esp_netif_driver.html">ESP-NETIF Custom I/O Driver</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="index.html#application-layer">Application Layer</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../peripherals/index.html">Peripherals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/index.html">Protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../provisioning/index.html">Provisioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../storage/index.html">Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../system/index.html">System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kconfig.html">Configuration Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../error-codes.html">Error Codes Reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../hw-reference/index.html">H/W Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../esp32s2.html">ESP32-S2 Preview Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api-guides/index.html">API Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../libraries-and-frameworks/index.html">Libraries and Frameworks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../versions.html">Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COPYRIGHT.html">Copyrights</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../languages.html">语言/Languages</a></li>
<li class="toctree-l1"><a class="reference external" href="https://readthedocs.com/projects/espressif-esp-idf/downloads/">Guide Downloads</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ESP-IDF Programming Guide</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">API Reference</a> &raquo;</li>
        
          <li><a href="index.html">Networking APIs</a> &raquo;</li>
        
      <li>TCP/IP Adapter Migration Guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/espressif/esp-idf/blob/master/docs/en/api-reference/network/tcpip_adapter_migration.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tcp-ip-adapter-migration-guide">
<h1>TCP/IP Adapter Migration Guide<a class="headerlink" href="tcpip_adapter_migration.html#tcp-ip-adapter-migration-guide" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://espressif-docs.readthedocs-hosted.com/projects/esp-idf/zh_CN/latest/api-reference/network/tcpip_adapter_migration.html">[中文]</a></p>
<p>TCP/IP Adapter is a network interface abstraction component used in IDF prior to v4.1. This page outlines migration from tcpip_adapter API to its successor <a class="reference internal" href="esp_netif.html"><span class="doc">ESP-NETIF</span></a>.</p>
<div class="section" id="updating-network-connection-code">
<h2>Updating network connection code<a class="headerlink" href="tcpip_adapter_migration.html#updating-network-connection-code" title="Permalink to this headline">¶</a></h2>
<div class="section" id="network-stack-initialization">
<h3>Network stack initialization<a class="headerlink" href="tcpip_adapter_migration.html#network-stack-initialization" title="Permalink to this headline">¶</a></h3>
<p>Simply replace <code class="docutils literal notranslate"><span class="pre">tcpip_adapter_init()</span></code> with <code class="docutils literal notranslate"><span class="pre">esp_netif_init()</span></code>. Please note that the <a class="reference internal" href="esp_netif.html"><span class="doc">ESP-NETIF</span></a> initialization API returns standard error code and the <code class="docutils literal notranslate"><span class="pre">esp_netif_deinit()</span></code> for un-initialization is available.</p>
<p>Also replace <code class="docutils literal notranslate"><span class="pre">#include</span> <span class="pre">&quot;tcpip_adapter.h&quot;</span></code> with <code class="docutils literal notranslate"><span class="pre">#include</span> <span class="pre">&quot;esp_netif.h&quot;</span></code>.</p>
</div>
<div class="section" id="network-interface-creation">
<h3>Network interface creation<a class="headerlink" href="tcpip_adapter_migration.html#network-interface-creation" title="Permalink to this headline">¶</a></h3>
<p>TCP/IP Adapter defined these three interfaces statically:</p>
<ul class="simple">
<li>WiFi Station</li>
<li>WiFi Access Point</li>
<li>Ethernet</li>
</ul>
<p>Network interface instance shall be explicitly constructed for the <a class="reference internal" href="esp_netif.html"><span class="doc">ESP-NETIF</span></a> to enable its connection to the TCP/IP stack.
For example initialization code for WiFi has to explicitly call <code class="docutils literal notranslate"><span class="pre">esp_netif_create_default_wifi_sta();</span></code> or <code class="docutils literal notranslate"><span class="pre">esp_netif_create_default_wifi_ap();</span></code> after the TCP/IP stack and the event loop have been initialized.
Please consult an example initialization code for these three interfaces:</p>
<ul class="simple">
<li>WiFi Station: <a class="reference external" href="https://github.com/espressif/esp-idf/tree/f91080637/examples/wifi/getting_started/station/main/station_example_main.c">wifi/getting_started/station/main/station_example_main.c</a></li>
<li>WiFi Access Point: <a class="reference external" href="https://github.com/espressif/esp-idf/tree/f91080637/examples/wifi/getting_started/softAP/main/softap_example_main.c">wifi/getting_started/softAP/main/softap_example_main.c</a></li>
<li>Ethernet: <a class="reference external" href="https://github.com/espressif/esp-idf/tree/f91080637/examples/ethernet/basic/main/ethernet_example_main.c">ethernet/basic/main/ethernet_example_main.c</a></li>
</ul>
</div>
<div class="section" id="replacing-other-tcpip-adapter-api">
<h3>Replacing other tcpip_adapter API<a class="headerlink" href="tcpip_adapter_migration.html#replacing-other-tcpip-adapter-api" title="Permalink to this headline">¶</a></h3>
<p>All the tcpip_adapter functions have their esp-netif counter-part. Please refer to the esp_netif.h grouped into these sections:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/espressif/esp-idf/blob/f91080637/components/esp_netif/include/esp_netif.h#L241">Setters/Getters </a></li>
<li><a class="reference external" href="https://github.com/espressif/esp-idf/blob/f91080637/components/esp_netif/include/esp_netif.h#L387">DHCP </a></li>
<li><a class="reference external" href="https://github.com/espressif/esp-idf/blob/f91080637/components/esp_netif/include/esp_netif.h#L516">DNS </a></li>
<li><a class="reference external" href="https://github.com/espressif/esp-idf/blob/f91080637/components/esp_netif/include/esp_netif.h#L568">IP address </a></li>
</ul>
</div>
<div class="section" id="default-event-handlers">
<h3>Default event handlers<a class="headerlink" href="tcpip_adapter_migration.html#default-event-handlers" title="Permalink to this headline">¶</a></h3>
<p>Event handlers are moved from tcpip_adapter to appropriate driver code. There is no change from application code perspective, all events shall be handled in the same way.
Please note that within IP related event handlers, application code usually receives IP addresses in a form of esp-netif specific struct (not the LwIP structs, but binary compatible).
This is the preferred way of printing the address:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s">&quot;got ip:&quot;</span> <span class="n">IPSTR</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">IP2STR</span><span class="p">(</span><span class="o">&amp;</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">ip_info</span><span class="p">.</span><span class="n">ip</span><span class="p">));</span>
</pre></div>
</div>
<p>Instead of</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s">&quot;got ip:%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ip4addr_ntoa</span><span class="p">(</span><span class="o">&amp;</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">ip_info</span><span class="p">.</span><span class="n">ip</span><span class="p">));</span>
</pre></div>
</div>
<p>Since <code class="docutils literal notranslate"><span class="pre">ip4addr_ntoa()</span></code> is a LwIP API, the esp-netif provides <code class="docutils literal notranslate"><span class="pre">esp_ip4addr_ntoa()</span></code> as a replacement, but the above method is generally preferred.</p>
</div>
<div class="section" id="ip-addresses">
<h3>IP addresses<a class="headerlink" href="tcpip_adapter_migration.html#ip-addresses" title="Permalink to this headline">¶</a></h3>
<p>It is preferred to use esp-netif defined IP structures. Please note that the LwIP structs will still work when default compatibility enabled.
*  <a class="reference external" href="https://github.com/espressif/esp-idf/blob/f91080637/components/esp_netif/include/esp_netif_ip_addr.h#L96">esp-netif IP address definitions </a></p>
</div>
<div class="section" id="next-steps">
<h3>Next steps<a class="headerlink" href="tcpip_adapter_migration.html#next-steps" title="Permalink to this headline">¶</a></h3>
<p>Additional step in porting an application to fully benefit from the <a class="reference internal" href="esp_netif.html"><span class="doc">ESP-NETIF</span></a> is to disable the tcpip_adapter compatibility layer in the component configuration:
<code class="docutils literal notranslate"><span class="pre">ESP</span> <span class="pre">NETIF</span> <span class="pre">Adapter</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Enable</span> <span class="pre">backward</span> <span class="pre">compatible</span> <span class="pre">tcpip_adapter</span> <span class="pre">interface</span></code> and check if the project compiles.
TCP/IP adapter brings many include dependencies and this step might help in decoupling the application from using specific TCP/IP stack API directly.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="esp_netif_driver.html" class="btn btn-neutral float-right" title="ESP-NETIF Custom I/O Driver" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="esp_netif.html" class="btn btn-neutral float-left" title="ESP-NETIF" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016 - 2019, Espressif Systems (Shanghai) CO., LTD
      
        <span class="commit">
          Revision <code>f9108063</code>.
        </span>
      

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  



  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
   

</body>
</html>