

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Inter-Processor Call &mdash; ESP-IDF Programming Guide v4.1-dev-2071-gf91080637 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script type="text/javascript" src="https://media.readthedocs.com/javascript/readthedocs-doc-embed.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Call function with external stack" href="esp_expression_with_stack.html" />
    <link rel="prev" title="The himem allocation API" href="himem.html" /> 

<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="https://docs.espressif.com/projects/esp-idf/en/latest/api-reference/system/ipc.html" />

<link rel="stylesheet" href="https://media.readthedocs.com/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="../../_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = "api-reference/system/ipc"
READTHEDOCS_DATA['source_suffix'] = ".rst"
</script>

<script type="text/javascript" src="https://media.readthedocs.com/javascript/readthedocs-analytics.js"></script>

<!-- end RTD <extrahead> -->
<script async type="text/javascript" src="../../../../../../_/static/javascript/readthedocs-addons.js"></script><meta name="readthedocs-project-slug" content="espressif-esp-idf" /><meta name="readthedocs-version-slug" content="latest" /><meta name="readthedocs-resolver-filename" content="/api-reference/system/ipc.html" /><meta name="readthedocs-http-status" content="200" /></head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> ESP-IDF Programming Guide
          

          
            
            <img src="../../_static/espressif-logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../get-started/index.html">Get Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../bluetooth/index.html">Bluetooth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../network/index.html">Networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../peripherals/index.html">Peripherals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/index.html">Protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../provisioning/index.html">Provisioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../storage/index.html">Storage</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">System</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="app_image_format.html">App image format</a></li>
<li class="toctree-l3"><a class="reference internal" href="app_trace.html">Application Level Tracing</a></li>
<li class="toctree-l3"><a class="reference internal" href="efuse.html">eFuse Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="esp_err.html">Error Codes and Helper Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="esp_https_ota.html">ESP HTTPS OTA</a></li>
<li class="toctree-l3"><a class="reference internal" href="esp_pthread.html">ESP pthread</a></li>
<li class="toctree-l3"><a class="reference internal" href="esp_event.html">Event Loop Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="freertos.html">FreeRTOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="freertos_additions.html">FreeRTOS Additions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mem_alloc.html">Heap Memory Allocation</a></li>
<li class="toctree-l3"><a class="reference internal" href="heap_debug.html">Heap Memory Debugging</a></li>
<li class="toctree-l3"><a class="reference internal" href="esp_timer.html">High Resolution Timer</a></li>
<li class="toctree-l3"><a class="reference internal" href="himem.html">Himem (large external SPI RAM) API</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="ipc.html#">Inter-Processor Call</a><ul>
<li class="toctree-l4"><a class="reference internal" href="ipc.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="ipc.html#usage">Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="ipc.html#api-reference">API Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="esp_expression_with_stack.html">Call function with external stack</a></li>
<li class="toctree-l3"><a class="reference internal" href="intr_alloc.html">Interrupt Allocation</a></li>
<li class="toctree-l3"><a class="reference internal" href="log.html">Logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="system.html">Miscellaneous System APIs</a></li>
<li class="toctree-l3"><a class="reference internal" href="ota.html">Over The Air Updates (OTA)</a></li>
<li class="toctree-l3"><a class="reference internal" href="perfmon.html">Performance Monitor</a></li>
<li class="toctree-l3"><a class="reference internal" href="power_management.html">Power Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="sleep_modes.html">Sleep Modes</a></li>
<li class="toctree-l3"><a class="reference internal" href="wdts.html">Watchdogs</a></li>
<li class="toctree-l3"><a class="reference internal" href="system_time.html">System Time</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../kconfig.html">Configuration Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../error-codes.html">Error Codes Reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../hw-reference/index.html">H/W Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../esp32s2.html">ESP32-S2 Preview Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api-guides/index.html">API Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../libraries-and-frameworks/index.html">Libraries and Frameworks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../versions.html">Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COPYRIGHT.html">Copyrights</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../languages.html">语言/Languages</a></li>
<li class="toctree-l1"><a class="reference external" href="https://readthedocs.com/projects/espressif-esp-idf/downloads/">Guide Downloads</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ESP-IDF Programming Guide</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">API Reference</a> &raquo;</li>
        
          <li><a href="index.html">System API</a> &raquo;</li>
        
      <li>Inter-Processor Call</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/espressif/esp-idf/blob/master/docs/en/api-reference/system/ipc.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="inter-processor-call">
<h1>Inter-Processor Call<a class="headerlink" href="ipc.html#inter-processor-call" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="ipc.html#overview" title="Permalink to this headline">¶</a></h2>
<p>Due to the dual core nature of the ESP32, there are instances where a certain
function must be run in the context of a particular core (e.g. allocating
ISR to an interrupt source of a particular core). The IPC (Inter-Processor
Call) feature allows for the execution of functions on a particular CPU.</p>
<p>A given function can be executed on a particular core by calling
<a class="reference internal" href="ipc.html#_CPPv412esp_ipc_call8uint32_t14esp_ipc_func_tPv" title="esp_ipc_call"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_ipc_call()</span></code></a> or <a class="reference internal" href="ipc.html#_CPPv421esp_ipc_call_blocking8uint32_t14esp_ipc_func_tPv" title="esp_ipc_call_blocking"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_ipc_call_blocking()</span></code></a>. IPC is
implemented via two high priority FreeRTOS tasks pinned to each CPU known as
the IPC Tasks. The two IPC Tasks remain inactive (blocked) until
<a class="reference internal" href="ipc.html#_CPPv412esp_ipc_call8uint32_t14esp_ipc_func_tPv" title="esp_ipc_call"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_ipc_call()</span></code></a> or <a class="reference internal" href="ipc.html#_CPPv421esp_ipc_call_blocking8uint32_t14esp_ipc_func_tPv" title="esp_ipc_call_blocking"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_ipc_call_blocking()</span></code></a> is called. When
an IPC Task of a particular core is unblocked, it will preempt the current
running task on that core and execute a given function.</p>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="ipc.html#usage" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="ipc.html#_CPPv412esp_ipc_call8uint32_t14esp_ipc_func_tPv" title="esp_ipc_call"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_ipc_call()</span></code></a> unblocks the IPC task on a particular core to execute
a given function. The task that calls <a class="reference internal" href="ipc.html#_CPPv412esp_ipc_call8uint32_t14esp_ipc_func_tPv" title="esp_ipc_call"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_ipc_call()</span></code></a> will be blocked
until the IPC Task begins execution of the given function.
<a class="reference internal" href="ipc.html#_CPPv421esp_ipc_call_blocking8uint32_t14esp_ipc_func_tPv" title="esp_ipc_call_blocking"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_ipc_call_blocking()</span></code></a> is similar but will block the calling task
until the IPC Task has completed execution of the given function.</p>
<p>Functions executed by IPCs must be functions of type
<cite>void func(void *arg)</cite>. To run more complex functions which require a larger
stack, the IPC tasks’ stack size can be configured by modifying
<a class="reference internal" href="../kconfig.html#config-esp-ipc-task-stack-size"><span class="std std-ref">CONFIG_ESP_IPC_TASK_STACK_SIZE</span></a> in <cite>menuconfig</cite>. The IPC API is protected by a
mutex hence simultaneous IPC calls are not possible.</p>
<p>Care should taken to avoid deadlock when writing functions to be executed by
IPC, especially when attempting to take a mutex within the function.</p>
</div>
<div class="section" id="api-reference">
<h2>API Reference<a class="headerlink" href="ipc.html#api-reference" title="Permalink to this headline">¶</a></h2>
<div class="section" id="header-file">
<h3>Header File<a class="headerlink" href="ipc.html#header-file" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="https://github.com/espressif/esp-idf/blob/f91080637/components/esp_common/include/esp_ipc.h">esp_common/include/esp_ipc.h</a></li>
</ul>
</div>
<div class="section" id="functions">
<h3>Functions<a class="headerlink" href="ipc.html#functions" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="_CPPv412esp_ipc_call8uint32_t14esp_ipc_func_tPv">
<span id="_CPPv312esp_ipc_call8uint32_t14esp_ipc_func_tPv"></span><span id="_CPPv212esp_ipc_call8uint32_t14esp_ipc_func_tPv"></span><span id="esp_ipc_call__uint32_t.esp_ipc_func_t.voidP"></span><span class="target" id="esp__ipc_8h_1a01d55eb5b88c3e5a62e26d44cd8237b6"></span><a class="reference internal" href="esp_err.html#_CPPv49esp_err_t" title="esp_err_t">esp_err_t</a> <code class="descname">esp_ipc_call</code><span class="sig-paren">(</span>uint32_t <em>cpu_id</em>, esp_ipc_func_t <em>func</em>, void *<em>arg</em><span class="sig-paren">)</span><a class="headerlink" href="ipc.html#_CPPv412esp_ipc_call8uint32_t14esp_ipc_func_tPv" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Execute a function on the given CPU. </p>
<p>Run a given function on a particular CPU. The given function must accept a void* argument and return void. The given function is run in the context of the IPC task of the CPU specified by the cpu_id parameter. The calling task will be blocked until the IPC task begins executing the given function. If another IPC call is ongoing, the calling task will block until the other IPC call completes. The stack size allocated for the IPC task can be configured in the “Inter-Processor Call (IPC) task stack size” setting in menuconfig. Increase this setting if the given function requires more stack than default.</p>
<p><dl class="docutils">
<dt><strong>Note</strong></dt>
<dd>In single-core mode, returns ESP_ERR_INVALID_ARG for cpu_id 1.</dd>
<dt><strong>Return</strong></dt>
<dd><ul class="simple">
<li>ESP_ERR_INVALID_ARG if cpu_id is invalid</li>
<li>ESP_ERR_INVALID_STATE if the FreeRTOS scheduler is not running</li>
<li>ESP_OK otherwise </li>
</ul>
</dd>
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">cpu_id</span></code>: CPU where the given function should be executed (0 or 1) </li>
<li><code class="docutils literal notranslate"><span class="pre">func</span></code>: Pointer to a function of type void func(void* arg) to be executed </li>
<li><code class="docutils literal notranslate"><span class="pre">arg</span></code>: Arbitrary argument of type void* to be passed into the function</li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv421esp_ipc_call_blocking8uint32_t14esp_ipc_func_tPv">
<span id="_CPPv321esp_ipc_call_blocking8uint32_t14esp_ipc_func_tPv"></span><span id="_CPPv221esp_ipc_call_blocking8uint32_t14esp_ipc_func_tPv"></span><span id="esp_ipc_call_blocking__uint32_t.esp_ipc_func_t.voidP"></span><span class="target" id="esp__ipc_8h_1a45584b94dc433564514c6bbdb0fc4eb1"></span><a class="reference internal" href="esp_err.html#_CPPv49esp_err_t" title="esp_err_t">esp_err_t</a> <code class="descname">esp_ipc_call_blocking</code><span class="sig-paren">(</span>uint32_t <em>cpu_id</em>, esp_ipc_func_t <em>func</em>, void *<em>arg</em><span class="sig-paren">)</span><a class="headerlink" href="ipc.html#_CPPv421esp_ipc_call_blocking8uint32_t14esp_ipc_func_tPv" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Execute a function on the given CPU and blocks until it completes. </p>
<p>Run a given function on a particular CPU. The given function must accept a void* argument and return void. The given function is run in the context of the IPC task of the CPU specified by the cpu_id parameter. The calling task will be blocked until the IPC task completes execution of the given function. If another IPC call is ongoing, the calling task will block until the other IPC call completes. The stack size allocated for the IPC task can be configured in the “Inter-Processor Call (IPC) task stack size” setting in menuconfig. Increase this setting if the given function requires more stack than default.</p>
<p><dl class="docutils">
<dt><strong>Note</strong></dt>
<dd>In single-core mode, returns ESP_ERR_INVALID_ARG for cpu_id 1.</dd>
<dt><strong>Return</strong></dt>
<dd><ul class="simple">
<li>ESP_ERR_INVALID_ARG if cpu_id is invalid</li>
<li>ESP_ERR_INVALID_STATE if the FreeRTOS scheduler is not running</li>
<li>ESP_OK otherwise </li>
</ul>
</dd>
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">cpu_id</span></code>: CPU where the given function should be executed (0 or 1) </li>
<li><code class="docutils literal notranslate"><span class="pre">func</span></code>: Pointer to a function of type void func(void* arg) to be executed </li>
<li><code class="docutils literal notranslate"><span class="pre">arg</span></code>: Arbitrary argument of type void* to be passed into the function</li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="esp_expression_with_stack.html" class="btn btn-neutral float-right" title="Call function with external stack" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="himem.html" class="btn btn-neutral float-left" title="The himem allocation API" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016 - 2019, Espressif Systems (Shanghai) CO., LTD
      
        <span class="commit">
          Revision <code>f9108063</code>.
        </span>
      

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  



  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
   

</body>
</html>