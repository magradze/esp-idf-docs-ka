

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>System Time &mdash; ESP-IDF Programming Guide v4.1-dev-2071-gf91080637 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script type="text/javascript" src="https://media.readthedocs.com/javascript/readthedocs-doc-embed.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Project Configuration" href="../kconfig.html" />
    <link rel="prev" title="Watchdogs" href="wdts.html" /> 

<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="https://docs.espressif.com/projects/esp-idf/en/latest/api-reference/system/system_time.html" />

<link rel="stylesheet" href="https://media.readthedocs.com/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="../../_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = "api-reference/system/system_time"
READTHEDOCS_DATA['source_suffix'] = ".rst"
</script>

<script type="text/javascript" src="https://media.readthedocs.com/javascript/readthedocs-analytics.js"></script>

<!-- end RTD <extrahead> -->
<script async type="text/javascript" src="../../../../../../_/static/javascript/readthedocs-addons.js"></script><meta name="readthedocs-project-slug" content="espressif-esp-idf" /><meta name="readthedocs-version-slug" content="latest" /><meta name="readthedocs-resolver-filename" content="/api-reference/system/system_time.html" /><meta name="readthedocs-http-status" content="200" /></head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> ESP-IDF Programming Guide
          

          
            
            <img src="../../_static/espressif-logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../get-started/index.html">Get Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../bluetooth/index.html">Bluetooth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../network/index.html">Networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../peripherals/index.html">Peripherals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/index.html">Protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../provisioning/index.html">Provisioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../storage/index.html">Storage</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">System</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="app_image_format.html">App image format</a></li>
<li class="toctree-l3"><a class="reference internal" href="app_trace.html">Application Level Tracing</a></li>
<li class="toctree-l3"><a class="reference internal" href="efuse.html">eFuse Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="esp_err.html">Error Codes and Helper Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="esp_https_ota.html">ESP HTTPS OTA</a></li>
<li class="toctree-l3"><a class="reference internal" href="esp_pthread.html">ESP pthread</a></li>
<li class="toctree-l3"><a class="reference internal" href="esp_event.html">Event Loop Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="freertos.html">FreeRTOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="freertos_additions.html">FreeRTOS Additions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mem_alloc.html">Heap Memory Allocation</a></li>
<li class="toctree-l3"><a class="reference internal" href="heap_debug.html">Heap Memory Debugging</a></li>
<li class="toctree-l3"><a class="reference internal" href="esp_timer.html">High Resolution Timer</a></li>
<li class="toctree-l3"><a class="reference internal" href="himem.html">Himem (large external SPI RAM) API</a></li>
<li class="toctree-l3"><a class="reference internal" href="ipc.html">Inter-Processor Call</a></li>
<li class="toctree-l3"><a class="reference internal" href="esp_expression_with_stack.html">Call function with external stack</a></li>
<li class="toctree-l3"><a class="reference internal" href="intr_alloc.html">Interrupt Allocation</a></li>
<li class="toctree-l3"><a class="reference internal" href="log.html">Logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="system.html">Miscellaneous System APIs</a></li>
<li class="toctree-l3"><a class="reference internal" href="ota.html">Over The Air Updates (OTA)</a></li>
<li class="toctree-l3"><a class="reference internal" href="perfmon.html">Performance Monitor</a></li>
<li class="toctree-l3"><a class="reference internal" href="power_management.html">Power Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="sleep_modes.html">Sleep Modes</a></li>
<li class="toctree-l3"><a class="reference internal" href="wdts.html">Watchdogs</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="system_time.html#">System Time</a><ul>
<li class="toctree-l4"><a class="reference internal" href="system_time.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="system_time.html#rtc-clock-source">RTC Clock Source</a></li>
<li class="toctree-l4"><a class="reference internal" href="system_time.html#get-current-time">Get Current Time</a></li>
<li class="toctree-l4"><a class="reference internal" href="system_time.html#sntp-time-synchronization">SNTP Time Synchronization</a></li>
<li class="toctree-l4"><a class="reference internal" href="system_time.html#timezones">Timezones</a></li>
<li class="toctree-l4"><a class="reference internal" href="system_time.html#api-reference">API Reference</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../kconfig.html">Configuration Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../error-codes.html">Error Codes Reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../hw-reference/index.html">H/W Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../esp32s2.html">ESP32-S2 Preview Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api-guides/index.html">API Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../libraries-and-frameworks/index.html">Libraries and Frameworks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../versions.html">Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COPYRIGHT.html">Copyrights</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../languages.html">语言/Languages</a></li>
<li class="toctree-l1"><a class="reference external" href="https://readthedocs.com/projects/espressif-esp-idf/downloads/">Guide Downloads</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ESP-IDF Programming Guide</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">API Reference</a> &raquo;</li>
        
          <li><a href="index.html">System API</a> &raquo;</li>
        
      <li>System Time</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/espressif/esp-idf/blob/master/docs/en/api-reference/system/system_time.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="system-time">
<h1>System Time<a class="headerlink" href="system_time.html#system-time" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="system_time.html#overview" title="Permalink to this headline">¶</a></h2>
<p>System time can be kept using either one time source or two time sources simultaneously. The choice depends on the application purpose and accuracy requirements for system time.</p>
<p>There are the following two time sources:</p>
<ul class="simple">
<li><strong>RTC timer</strong>: Allows keeping the system time during any resets and sleep modes, only the power-up reset leads to resetting the RTC timer. The frequency deviation depends on an <a class="reference internal" href="system_time.html#rtc-clock-source">RTC Clock Source</a> and affects accuracy only in sleep modes, in which case the time will be measured at 6.6667 us resolution.</li>
<li><strong>High-resolution timer</strong>: Not available during any reset and sleep modes. The reason for using this timer is to achieve greater accuracy. It uses the APB_CLK clock source (typically 80 MHz), which has a frequency deviation of less than ±10 ppm. Time will be measured at 1 us resolution.</li>
</ul>
<p>The settings for the system time source are as follows:</p>
<ul class="simple">
<li>RTC and high-resolution timer (default)</li>
<li>RTC</li>
<li>High-resolution timer</li>
<li>None</li>
</ul>
<p>It is recommended to stick to the default setting which provides maximum accuracy. If you want to choose a different timer, configure <a class="reference internal" href="../kconfig.html#config-esp32-time-syscall"><span class="std std-ref">CONFIG_ESP32_TIME_SYSCALL</span></a> in project configuration.</p>
</div>
<div class="section" id="rtc-clock-source">
<h2>RTC Clock Source<a class="headerlink" href="system_time.html#rtc-clock-source" title="Permalink to this headline">¶</a></h2>
<p>The RTC timer has the following clock sources:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">Internal</span> <span class="pre">150kHz</span> <span class="pre">RC</span> <span class="pre">oscillator</span></code> (default): Features lowest deep sleep current consumption and no dependence on any external components. However, as frequency stability is affected by temperature fluctuations, time may drift in both Deep and Light sleep modes.</li>
<li><code class="docutils literal notranslate"><span class="pre">External</span> <span class="pre">32kHz</span> <span class="pre">crystal</span></code>: Requires a 32kHz crystal to be connected to the 32K_XP and 32K_NP pins. Provides better frequency stability at the expense of slightly higher (by 1 uA) Deep sleep current consumption.</li>
<li><code class="docutils literal notranslate"><span class="pre">External</span> <span class="pre">32kHz</span> <span class="pre">oscillator</span> <span class="pre">at</span> <span class="pre">32K_XP</span> <span class="pre">pin</span></code>: Allows using 32kHz clock generated by an external circuit. The external clock signal must be connected to the 32K_XP pin. The amplitude should be less than 1.2 V for sine wave signal and less than 1 V for square wave signal. Common mode voltage should be in the range of 0.1 &lt; Vcm &lt; 0.5xVamp, where Vamp is signal amplitude. Additionally, a 1 nF capacitor must be placed between the 32K_XN pin and ground. In this case, the 32K_XN pin cannot be used as a GPIO pin.</li>
<li><code class="docutils literal notranslate"><span class="pre">Internal</span> <span class="pre">8.5MHz</span> <span class="pre">oscillator,</span> <span class="pre">divided</span> <span class="pre">by</span> <span class="pre">256</span> <span class="pre">(~33kHz)</span></code>. Provides better frequency stability than the <code class="docutils literal notranslate"><span class="pre">internal</span> <span class="pre">150kHz</span> <span class="pre">RC</span> <span class="pre">oscillator</span></code> at the expense of higher (by 5 uA) deep sleep current consumption. It also does not require external components.</li>
</ul>
<p>The choice depends on your requirements for system time accuracy and power consumption in sleep modes. To modify the RTC clock source, set <a class="reference internal" href="../kconfig.html#config-esp32-rtc-clk-src"><span class="std std-ref">CONFIG_ESP32_RTC_CLK_SRC</span></a> in project configuration.</p>
<p>More details on wiring requirements for the <code class="docutils literal notranslate"><span class="pre">External</span> <span class="pre">32kHz</span> <span class="pre">crystal</span></code> and <code class="docutils literal notranslate"><span class="pre">External</span> <span class="pre">32kHz</span> <span class="pre">oscillator</span> <span class="pre">at</span> <span class="pre">32K_XP</span> <span class="pre">pin</span></code> sources can be found in Section 2.1.4 <em>Crystal Oscillator</em> of <a class="reference external" href="https://www.espressif.com/sites/default/files/documentation/esp32_hardware_design_guidelines_en.pdf#page=10">Hardware Design Guidelines</a>.</p>
</div>
<div class="section" id="get-current-time">
<h2>Get Current Time<a class="headerlink" href="system_time.html#get-current-time" title="Permalink to this headline">¶</a></h2>
<p>To get the current time, use the POSIX function <code class="docutils literal notranslate"><span class="pre">gettimeofday()</span></code>. Additionally, you can use the following standard C library functions to obtain time and manipulate it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gettimeofday
<span class="nb">time</span>
asctime
clock
ctime
difftime
gmtime
localtime
mktime
strftime
adjtime*
</pre></div>
</div>
<p>* – To stop smooth time adjustment and update the current time immediately, use the POSIX function <code class="docutils literal notranslate"><span class="pre">settimeofday()</span></code>.</p>
<p>If you need to obtain time with one second resolution, use the following method:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">time_t</span> <span class="n">now</span><span class="p">;</span>
<span class="kt">char</span> <span class="n">strftime_buf</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
<span class="k">struct</span> <span class="n">tm</span> <span class="n">timeinfo</span><span class="p">;</span>

<span class="n">time</span><span class="p">(</span><span class="o">&amp;</span><span class="n">now</span><span class="p">);</span>
<span class="c1">// Set timezone to China Standard Time</span>
<span class="n">setenv</span><span class="p">(</span><span class="s">&quot;TZ&quot;</span><span class="p">,</span> <span class="s">&quot;CST-8&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">tzset</span><span class="p">();</span>

<span class="n">localtime_r</span><span class="p">(</span><span class="o">&amp;</span><span class="n">now</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">timeinfo</span><span class="p">);</span>
<span class="n">strftime</span><span class="p">(</span><span class="n">strftime_buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">strftime_buf</span><span class="p">),</span> <span class="s">&quot;%c&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">timeinfo</span><span class="p">);</span>
<span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s">&quot;The current date/time in Shanghai is: %s&quot;</span><span class="p">,</span> <span class="n">strftime_buf</span><span class="p">);</span>
</pre></div>
</div>
<p>If you need to obtain time with one microsecond resolution, use the code snippet below:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">timeval</span> <span class="n">tv_now</span><span class="p">;</span>
<span class="n">gettimeofday</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tv_now</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="kt">int64_t</span> <span class="n">time_us</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int64_t</span><span class="p">)</span><span class="n">tv_now</span><span class="p">.</span><span class="n">tv_sec</span> <span class="o">*</span> <span class="mi">1000000L</span> <span class="o">+</span> <span class="p">(</span><span class="kt">int64_t</span><span class="p">)</span><span class="n">tv_now</span><span class="p">.</span><span class="n">tv_usec</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="sntp-time-synchronization">
<span id="system-time-sntp-sync"></span><h2>SNTP Time Synchronization<a class="headerlink" href="system_time.html#sntp-time-synchronization" title="Permalink to this headline">¶</a></h2>
<p>To set the current time, you can use the POSIX functions <code class="docutils literal notranslate"><span class="pre">settimeofday()</span></code> and <code class="docutils literal notranslate"><span class="pre">adjtime()</span></code>. They are used internally in the lwIP SNTP library to set current time when a response from the NTP server is received. These functions can also be used separately from the lwIP SNTP library.</p>
<p>A function to use inside the lwIP SNTP library depends on a sync mode for system time. Use the function <a class="reference internal" href="system_time.html#_CPPv418sntp_set_sync_mode16sntp_sync_mode_t" title="sntp_set_sync_mode"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">sntp_set_sync_mode()</span></code></a> to set one of the following sync modes:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">SNTP_SYNC_MODE_IMMED</span></code> (default) updates system time immediately upon receiving a response from the SNTP server after using <code class="docutils literal notranslate"><span class="pre">settimeofday()</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">SNTP_SYNC_MODE_SMOOTH</span></code> updates time smoothly by gradually reducing time error using the funcion <code class="docutils literal notranslate"><span class="pre">adjtime()</span></code>. If the difference between the SNTP response time and system time is more than 35 minutes, update system time immediately by using <code class="docutils literal notranslate"><span class="pre">settimeofday()</span></code>.</li>
</ul>
<p>The lwIP SNTP library has API functions for setting a callback function for a certain event. You might need the following functions:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">sntp_set_time_sync_notification_cb()</span></code> - use it for setting a callback function that will notify of the time synchronization process</li>
<li><code class="docutils literal notranslate"><span class="pre">sntp_get_sync_status()</span></code> and <code class="docutils literal notranslate"><span class="pre">sntp_set_sync_status()</span></code> - use it to get/set time synchronization status</li>
</ul>
<p>To start synchronization via SNTP, just call the following three functions.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">sntp_setoperatingmode</span><span class="p">(</span><span class="n">SNTP_OPMODE_POLL</span><span class="p">);</span>
<span class="n">sntp_setservername</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;pool.ntp.org&quot;</span><span class="p">);</span>
<span class="n">sntp_init</span><span class="p">();</span>
</pre></div>
</div>
<p>An application with this initialization code will periodically synchronize the time. The time synchronization period is determined by <span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">CONFIG_LWIP_SNTP_UPDATE_DELAY</span></code> (default value is one hour). To modify the variable, set <a class="reference internal" href="../kconfig.html#config-lwip-sntp-update-delay"><span class="std std-ref">CONFIG_LWIP_SNTP_UPDATE_DELAY</span></a> in project configuration.</p>
<p>A code example that demonstrates the implementation of time synchronization based on the lwIP SNTP library is provided in <a class="reference external" href="https://github.com/espressif/esp-idf/tree/f91080637/examples/protocols/sntp">protocols/sntp</a> directory.</p>
</div>
<div class="section" id="timezones">
<h2>Timezones<a class="headerlink" href="system_time.html#timezones" title="Permalink to this headline">¶</a></h2>
<p>To set local timezone, use the following POSIX functions:</p>
<ol class="arabic simple">
<li>Call <code class="docutils literal notranslate"><span class="pre">setenv()</span></code> to set the <code class="docutils literal notranslate"><span class="pre">TZ</span></code> environment variable to the correct value depending on the device location. The format of the time string is the same as described in the <a class="reference external" href="https://www.gnu.org/software/libc/manual/html_node/TZ-Variable.html">GNU libc documentation</a> (although the implementation is different).</li>
<li>Call <code class="docutils literal notranslate"><span class="pre">tzset()</span></code> to update C library runtime data for the new time zone.</li>
</ol>
<p>Once these steps are completed, call the standard C library function <code class="docutils literal notranslate"><span class="pre">localtime()</span></code>, and it will return correct local time taking into account the time zone offset and daylight saving time.</p>
</div>
<div class="section" id="api-reference">
<h2>API Reference<a class="headerlink" href="system_time.html#api-reference" title="Permalink to this headline">¶</a></h2>
<div class="section" id="header-file">
<h3>Header File<a class="headerlink" href="system_time.html#header-file" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="https://github.com/espressif/esp-idf/blob/f91080637/components/lwip/include/apps/sntp/sntp.h">lwip/include/apps/sntp/sntp.h</a></li>
</ul>
</div>
<div class="section" id="functions">
<h3>Functions<a class="headerlink" href="system_time.html#functions" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="_CPPv414sntp_sync_timeP7timeval">
<span id="_CPPv314sntp_sync_timeP7timeval"></span><span id="_CPPv214sntp_sync_timeP7timeval"></span><span id="sntp_sync_time__timevalP"></span><span class="target" id="sntp_8h_1a9101bda3f9c6d3fc1f2c5bbba7a9751d"></span>void <code class="descname">sntp_sync_time</code><span class="sig-paren">(</span><em class="property">struct</em> timeval *<em>tv</em><span class="sig-paren">)</span><a class="headerlink" href="system_time.html#_CPPv414sntp_sync_timeP7timeval" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function updates the system time. </p>
<p>This is a weak-linked function. It is possible to replace all SNTP update functionality by placing a sntp_sync_time() function in the app firmware source. If the default implementation is used, calling sntp_set_sync_mode() allows the time synchronization mode to be changed to instant or smooth. If a callback function is registered via sntp_set_time_sync_notification_cb(), it will be called following time synchronization.</p>
<p><dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">tv</span></code>: Time received from SNTP server. </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv418sntp_set_sync_mode16sntp_sync_mode_t">
<span id="_CPPv318sntp_set_sync_mode16sntp_sync_mode_t"></span><span id="_CPPv218sntp_set_sync_mode16sntp_sync_mode_t"></span><span id="sntp_set_sync_mode__sntp_sync_mode_t"></span><span class="target" id="sntp_8h_1a1c586826c79d35c74befc297c46b60e4"></span>void <code class="descname">sntp_set_sync_mode</code><span class="sig-paren">(</span><a class="reference internal" href="system_time.html#_CPPv416sntp_sync_mode_t" title="sntp_sync_mode_t">sntp_sync_mode_t</a> <em>sync_mode</em><span class="sig-paren">)</span><a class="headerlink" href="system_time.html#_CPPv418sntp_set_sync_mode16sntp_sync_mode_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Set the sync mode. </p>
<p>Allowable two mode: SNTP_SYNC_MODE_IMMED and SNTP_SYNC_MODE_SMOOTH. <dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">sync_mode</span></code>: Sync mode. </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv418sntp_get_sync_modev">
<span id="_CPPv318sntp_get_sync_modev"></span><span id="_CPPv218sntp_get_sync_modev"></span><span id="sntp_get_sync_mode__void"></span><span class="target" id="sntp_8h_1a471a6ddc854123a70bb7f851bf5c7b3c"></span><a class="reference internal" href="system_time.html#_CPPv416sntp_sync_mode_t" title="sntp_sync_mode_t">sntp_sync_mode_t</a> <code class="descname">sntp_get_sync_mode</code><span class="sig-paren">(</span>void<span class="sig-paren">)</span><a class="headerlink" href="system_time.html#_CPPv418sntp_get_sync_modev" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get set sync mode. </p>
<p><dl class="docutils">
<dt><strong>Return</strong></dt>
<dd>SNTP_SYNC_MODE_IMMED: Update time immediately. SNTP_SYNC_MODE_SMOOTH: Smooth time updating. </dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv420sntp_get_sync_statusv">
<span id="_CPPv320sntp_get_sync_statusv"></span><span id="_CPPv220sntp_get_sync_statusv"></span><span id="sntp_get_sync_status__void"></span><span class="target" id="sntp_8h_1a3b69544d33d8284cacf1b0a3daa16e80"></span><a class="reference internal" href="system_time.html#_CPPv418sntp_sync_status_t" title="sntp_sync_status_t">sntp_sync_status_t</a> <code class="descname">sntp_get_sync_status</code><span class="sig-paren">(</span>void<span class="sig-paren">)</span><a class="headerlink" href="system_time.html#_CPPv420sntp_get_sync_statusv" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get status of time sync. </p>
<p>After the update is completed, the status will be returned as SNTP_SYNC_STATUS_COMPLETED. After that, the status will be reset to SNTP_SYNC_STATUS_RESET. If the update operation is not completed yet, the status will be SNTP_SYNC_STATUS_RESET. If a smooth mode was chosen and the synchronization is still continuing (adjtime works), then it will be SNTP_SYNC_STATUS_IN_PROGRESS.</p>
<p><dl class="docutils">
<dt><strong>Return</strong></dt>
<dd>SNTP_SYNC_STATUS_RESET: Reset status. SNTP_SYNC_STATUS_COMPLETED: Time is synchronized. SNTP_SYNC_STATUS_IN_PROGRESS: Smooth time sync in progress. </dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv420sntp_set_sync_status18sntp_sync_status_t">
<span id="_CPPv320sntp_set_sync_status18sntp_sync_status_t"></span><span id="_CPPv220sntp_set_sync_status18sntp_sync_status_t"></span><span id="sntp_set_sync_status__sntp_sync_status_t"></span><span class="target" id="sntp_8h_1a3b0229e19cc9c6d2ab6f18b4ea6ed2e6"></span>void <code class="descname">sntp_set_sync_status</code><span class="sig-paren">(</span><a class="reference internal" href="system_time.html#_CPPv418sntp_sync_status_t" title="sntp_sync_status_t">sntp_sync_status_t</a> <em>sync_status</em><span class="sig-paren">)</span><a class="headerlink" href="system_time.html#_CPPv420sntp_set_sync_status18sntp_sync_status_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Set status of time sync. </p>
<p><dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">sync_status</span></code>: status of time sync (see sntp_sync_status_t) </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv434sntp_set_time_sync_notification_cb19sntp_sync_time_cb_t">
<span id="_CPPv334sntp_set_time_sync_notification_cb19sntp_sync_time_cb_t"></span><span id="_CPPv234sntp_set_time_sync_notification_cb19sntp_sync_time_cb_t"></span><span id="sntp_set_time_sync_notification_cb__sntp_sync_time_cb_t"></span><span class="target" id="sntp_8h_1a621c4bc36aeb4eba8d20d24f8e880d46"></span>void <code class="descname">sntp_set_time_sync_notification_cb</code><span class="sig-paren">(</span><a class="reference internal" href="system_time.html#_CPPv419sntp_sync_time_cb_t" title="sntp_sync_time_cb_t">sntp_sync_time_cb_t</a> <em>callback</em><span class="sig-paren">)</span><a class="headerlink" href="system_time.html#_CPPv434sntp_set_time_sync_notification_cb19sntp_sync_time_cb_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Set a callback function for time synchronization notification. </p>
<p><dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">callback</span></code>: a callback function </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv422sntp_set_sync_interval8uint32_t">
<span id="_CPPv322sntp_set_sync_interval8uint32_t"></span><span id="_CPPv222sntp_set_sync_interval8uint32_t"></span><span id="sntp_set_sync_interval__uint32_t"></span><span class="target" id="sntp_8h_1a4a9673511e778c14a3ec06341349327a"></span>void <code class="descname">sntp_set_sync_interval</code><span class="sig-paren">(</span>uint32_t <em>interval_ms</em><span class="sig-paren">)</span><a class="headerlink" href="system_time.html#_CPPv422sntp_set_sync_interval8uint32_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Set the sync interval of SNTP operation. </p>
<p>Note: SNTPv4 RFC 4330 enforces a minimum sync interval of 15 seconds. This sync interval will be used in the next attempt update time throught SNTP. To apply the new sync interval call the sntp_restart() function, otherwise, it will be applied after the last interval expired.</p>
<p><dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">interval_ms</span></code>: The sync interval in ms. It cannot be lower than 15 seconds, otherwise 15 seconds will be set. </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv422sntp_get_sync_intervalv">
<span id="_CPPv322sntp_get_sync_intervalv"></span><span id="_CPPv222sntp_get_sync_intervalv"></span><span id="sntp_get_sync_interval__void"></span><span class="target" id="sntp_8h_1a2001c0a80a61cdf7633a81aaa3489d47"></span>uint32_t <code class="descname">sntp_get_sync_interval</code><span class="sig-paren">(</span>void<span class="sig-paren">)</span><a class="headerlink" href="system_time.html#_CPPv422sntp_get_sync_intervalv" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get the sync interval of SNTP operation. </p>
<p><dl class="docutils">
<dt><strong>Return</strong></dt>
<dd>the sync interval </dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv412sntp_restartv">
<span id="_CPPv312sntp_restartv"></span><span id="_CPPv212sntp_restartv"></span><span id="sntp_restart__void"></span><span class="target" id="sntp_8h_1a307d0668e987c0c7383d75e76f0c6f06"></span>bool <code class="descname">sntp_restart</code><span class="sig-paren">(</span>void<span class="sig-paren">)</span><a class="headerlink" href="system_time.html#_CPPv412sntp_restartv" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Restart SNTP. </p>
<p><dl class="docutils">
<dt><strong>Return</strong></dt>
<dd>True - Restart False - SNTP was not initialized yet </dd>
</dl>
</p>
</dd></dl>

</div>
<div class="section" id="type-definitions">
<h3>Type Definitions<a class="headerlink" href="system_time.html#type-definitions" title="Permalink to this headline">¶</a></h3>
<dl class="type">
<dt id="_CPPv419sntp_sync_time_cb_t">
<span id="_CPPv319sntp_sync_time_cb_t"></span><span id="_CPPv219sntp_sync_time_cb_t"></span><span id="sntp_sync_time_cb_t"></span><span class="target" id="sntp_8h_1add4f7da4dc8335f57ef82d784f45704b"></span><em class="property">typedef </em>void (*<code class="descname">sntp_sync_time_cb_t</code>)<span class="sig-paren">(</span><em class="property">struct</em> timeval *tv<span class="sig-paren">)</span><a class="headerlink" href="system_time.html#_CPPv419sntp_sync_time_cb_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>SNTP callback function for notifying about time sync event. </p>
<p><dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">tv</span></code>: Time received from SNTP server. </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

</div>
<div class="section" id="enumerations">
<h3>Enumerations<a class="headerlink" href="system_time.html#enumerations" title="Permalink to this headline">¶</a></h3>
<dl class="type">
<dt id="_CPPv416sntp_sync_mode_t">
<span id="_CPPv316sntp_sync_mode_t"></span><span id="_CPPv216sntp_sync_mode_t"></span><span id="sntp_sync_mode_t"></span><span class="target" id="sntp_8h_1a7c613ec719f64a1c431f27ff2c0c9862"></span><em class="property">enum </em><code class="descname">sntp_sync_mode_t</code><a class="headerlink" href="system_time.html#_CPPv416sntp_sync_mode_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>SNTP time update mode. </p>
<p><em>Values:</em></p>
<dl class="enumerator">
<dt id="_CPPv420SNTP_SYNC_MODE_IMMED">
<span id="_CPPv320SNTP_SYNC_MODE_IMMED"></span><span id="_CPPv220SNTP_SYNC_MODE_IMMED"></span><span class="target" id="sntp_8h_1a7c613ec719f64a1c431f27ff2c0c9862ae070d39a87058cd8df94d3374b3af932"></span><code class="descname">SNTP_SYNC_MODE_IMMED</code><a class="headerlink" href="system_time.html#_CPPv420SNTP_SYNC_MODE_IMMED" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Update system time immediately when receiving a response from the SNTP server. </p>
</dd></dl>

<dl class="enumerator">
<dt id="_CPPv421SNTP_SYNC_MODE_SMOOTH">
<span id="_CPPv321SNTP_SYNC_MODE_SMOOTH"></span><span id="_CPPv221SNTP_SYNC_MODE_SMOOTH"></span><span class="target" id="sntp_8h_1a7c613ec719f64a1c431f27ff2c0c9862adf92a879a3eaad8f4bf9d38a1299473d"></span><code class="descname">SNTP_SYNC_MODE_SMOOTH</code><a class="headerlink" href="system_time.html#_CPPv421SNTP_SYNC_MODE_SMOOTH" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Smooth time updating. Time error is gradually reduced using adjtime function. If the difference between SNTP response time and system time is large (more than 35 minutes) then update immediately. </p>
</dd></dl>

</dd></dl>

<dl class="type">
<dt id="_CPPv418sntp_sync_status_t">
<span id="_CPPv318sntp_sync_status_t"></span><span id="_CPPv218sntp_sync_status_t"></span><span id="sntp_sync_status_t"></span><span class="target" id="sntp_8h_1ab7c41ad81cd97bea4f2a7c32b4dcdd63"></span><em class="property">enum </em><code class="descname">sntp_sync_status_t</code><a class="headerlink" href="system_time.html#_CPPv418sntp_sync_status_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>SNTP sync status. </p>
<p><em>Values:</em></p>
<dl class="enumerator">
<dt id="_CPPv422SNTP_SYNC_STATUS_RESET">
<span id="_CPPv322SNTP_SYNC_STATUS_RESET"></span><span id="_CPPv222SNTP_SYNC_STATUS_RESET"></span><span class="target" id="sntp_8h_1ab7c41ad81cd97bea4f2a7c32b4dcdd63a58cc684b1c59e9721d7b49b069e9f47a"></span><code class="descname">SNTP_SYNC_STATUS_RESET</code><a class="headerlink" href="system_time.html#_CPPv422SNTP_SYNC_STATUS_RESET" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<dl class="enumerator">
<dt id="_CPPv426SNTP_SYNC_STATUS_COMPLETED">
<span id="_CPPv326SNTP_SYNC_STATUS_COMPLETED"></span><span id="_CPPv226SNTP_SYNC_STATUS_COMPLETED"></span><span class="target" id="sntp_8h_1ab7c41ad81cd97bea4f2a7c32b4dcdd63a308c45b0fe542cfa5e91d3f44139bed4"></span><code class="descname">SNTP_SYNC_STATUS_COMPLETED</code><a class="headerlink" href="system_time.html#_CPPv426SNTP_SYNC_STATUS_COMPLETED" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<dl class="enumerator">
<dt id="_CPPv428SNTP_SYNC_STATUS_IN_PROGRESS">
<span id="_CPPv328SNTP_SYNC_STATUS_IN_PROGRESS"></span><span id="_CPPv228SNTP_SYNC_STATUS_IN_PROGRESS"></span><span class="target" id="sntp_8h_1ab7c41ad81cd97bea4f2a7c32b4dcdd63a7a41523fdd61af4e34bbb1d07d9f29b4"></span><code class="descname">SNTP_SYNC_STATUS_IN_PROGRESS</code><a class="headerlink" href="system_time.html#_CPPv428SNTP_SYNC_STATUS_IN_PROGRESS" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

</dd></dl>

</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../kconfig.html" class="btn btn-neutral float-right" title="Project Configuration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="wdts.html" class="btn btn-neutral float-left" title="Watchdogs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016 - 2019, Espressif Systems (Shanghai) CO., LTD
      
        <span class="commit">
          Revision <code>f9108063</code>.
        </span>
      

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  



  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
   

</body>
</html>